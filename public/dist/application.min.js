"use strict";var ApplicationConfiguration=function(){var a="apollo";return{applicationModuleName:a,applicationModuleVendorDependencies:["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ngAutocomplete","LocalStorageModule","angularFileUpload","angularMoment","gettext","btford.socket-io","angularPayments","meta","angular-google-analytics","seo"],registerModule:function(b){angular.module(b,[]),angular.module(a).requires.push(b)}}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.element(document).ready(function(){angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("en",{"(basis)":"(base)","(schoonmaak)":"(cleaning)","/ Maand":"/ Month","1 advertentie gevonden":["{{results.length}} ads found","{{$count}} ads found"],"1ROOF maakt je leven makkelijker.":"1ROOF makes your life easier.","1Roof is een website met een missie om voor jou alles makkelijker te maken. We streven ernaar om je op de simpelste manier dichterbij te brengen bij het pand van je dromen.":"1Roof is a website with a mission to make everything easier for you. We are committed to bring you closer to finding the place of your dreams.",'<h2 class="empty-icon text-center"><i class="icon-home-1"></i></h2>\n                <p class="lead text-center" translate="">Geen resultaten gevonden. Probeer minder filters te gebruiken of zoom uit op de kaart.</p>':'<h2 class="empty-icon text-center"><i class="icon-home-1"></i></h2>\n                <p class="lead text-center" translate="">No results found. Try using less filters or zoom out of the map.</p>',Aanpassen:"Modify",Achternaam:"Last name",Adres:"Address","Adres aanpassen":"Edit address","Adres van de ruimte":"Address of the premises","Adverteer je ruimte":"Advertise your room","Advertentie aanpassen":"Modify advertisement","Advertentie niet gevonden":"Advertisement not found",Afbeeldingen:"Images","Afbeeldingen toevoegen":"Add images","Afspraak maken":"Make appointment",Afspraken:"Appointments",Agentschap:"Agency",Algemeen:"General","Algemene informatie over de ruimte":"General information",Alle:"All","Alle rechten voorbehouden.":"All rights reserved.",Antwerpen:"Antwerp","Aparte badkamer":"Seperate bathroom","Aparte keuken":"Seperate kitchen","App.":"App.",Appartement:"Appartment","Auto garage":"Garage","Basis kosten":"Base costs","Basis prijs":"Base price","Bekijk al je berichten van huurders op één plaats":"View all your messages in one place","Bekijk deze ruimte":"View this room","Bekijk gedetailleerde statistieken over je advertentie":"View detailed statistics of your advertisement","Bericht versturen":"Send message",Berichten:"Messages","Beschikbaar van":"Available from",Beschikbaarheid:"Availability","Beschikbare voorzieningen":"Available amenities",Beschrijving:"Description","Bewaar de leukste aanbiedingen één plaats zodat je de beste er uit kan kiezen":"Save your preferred ads in one place so you can choose the best one",Bijgewerkt:"Modified",Brussel:"Brussels","Chat met je huisbaas":"Chat with your landlord",Chatten:"Chat",Contact:"Contact","Contacteer ons!":"Contact us!",Contactpersoon:"Contact",Contract:"Contract",Delen:"Share","Deze persoon heeft nog geen advertenties in zijn wishlist geplaatst":"No ads in this wishlist","Domicilie verplicht":"Domicile required",Driemaandelijks:"Quarterly","Dubbel glas":"Double glass","Elektriciteit, Gas en Water":"Electricity, Gas, and Water","Elke aanpassing die je maakt, wordt automatisch opgeslaan. Begin met een duidelijke titel.":"Every change you make is automatically saved. Start with a good title.","Email verzonden. Hou je inbox in de gaten.":"Email sent. Keep an eye on your inbox.","Er is iets misgelopen met het laden van deze inbox. Probeer later opniew.":"Something went wrong while loading this inbox. Try again later.","Er is iets misgelopen met het opslaan van de advertentie, probeer later opnieuw.":"Something went wrong while saving the ad, try again later.","Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw.":"Something went wrong with updating your subscription, please try again later.","Er is iets misgelopen met het verwijderen van deze inbox. Probeer later opniew.":"Something went wrong while deleting this inbox. Try again later.","Er is iets misgelopen met het verzenden van je berucht. Probeer later opniew.":"Something went wrong while sending your message. Try again later.","Er was een probleem bij het opslaan van je wijzigingen, probeer later opnieuw.":"Something went wrong while saving your changes, try again later.","Er was een probleem bij het toevoegen aan je favorieten, probeer later eens opnieuw.":"There was a problem adding it to your favorites, please try again later.","Er was een probleem bij het toevoegen van de afbeelding, probeer later eens opnieuw.":"There was a problem adding the image, try again later.","Er was een probleem met het verzenden van je bericht, probeer later eens opnieuw.":"There was a problem sending your message, please try again later.","Extra kosten":"Extra costs","Facturatie periode":"Billing period",Favorieten:"Favorites",Fietsstalling:"Bike shed","Foto uploaden":"Upload image","Ga verder":"Continue","Gas, elektriciteit en water (optioneel)":"Gas, electricity and water (optional)","Geef een duidelijke beschrijving over je ruimte":"Type a clear description of the ad","Geef een gepaste titel in":"Type a good title","Geef het adres in":"Type in the address","Geen resultaten gevonden. Probeer minder filters te gebruiken of zoom uit op de kaart.":"No results found. Try fewer filters or zoom out on the map.",Gemeubeld:"Furnished",Gent:"Ghent",Gratis:"Free",Hasselt:"Hasselt","Heb je al een account?":"Already have an account?",Home:"Home",Huis:"House",Huisbaas:"Landlord","Huisdieren toegelaten":"Pets allowed","Hulp nodig?":"Need help?","Ik heb al een account":"I already have an account","Ik zoek een huisgenoot":"I'm looking for a roommate","In welke periode is deze ruimte beschikbaar?":"In what period is this room available?",Inloggen:"Log in",Internet:"Internet","Items met een waarschuwing moet je oplossen voor je je advertentie online kan plaatsen.":"Items with a warning must be solved before you can place your ad online .",Jaarlijks:"Yearly","Je account is met succes aangemaakt! Je bent nu ingelogd.":"You have signed up successfully! You are now logged in.","Je bericht is verzonden!":"Your message is sent!","Je droomhuis nog niet kunnen vinden? Geen nood, we kunnen je een email sturen als er een advertentie wordt geplaatst die aan jouw criteria voldoet.":"Haven't found your dreamhouse yet? Do not worry, we can send you an email when an advertisement is placed that matches your criteria.","Je kan deze advertentie online plaatsen":"You can place this ad online","Je kan met één klik een afspraak maken met een huisbaas":"You can make an appointment with a landlord with just one click","Je moet een huisnummer ingeven":"You need to type a streetnumber","Je moet een straat intypen":"You need to type in an address","Je moet meer details ingeven":"You have to add more details","Je tariefplan is geupdatet!":"Your subscription has been updated!","Je wachtwoord is met succes aangepast!":"Your password is successfully changed!","Je wachtwoord vergeten?":"Forgot password?","Je zal samenzitten met <strong>{{room.cohabit.count}}</strong> andere(n) in dit pand.":"You will join <strong>{{room.cohabit.count}}</strong> other(s) in this place.","Kiezen van Dropbox":"Choose from Dropbox","Klaar om contact op te nemen met de eigenaar?":"Ready to contact the owner?",Kortrijk:"Kortrijk",Kosten:"Costs",Kot:"Room","Kot / Kamer":"Room","Krijg meldingen":"Get alerts","Laatst bijgewerkt {{room.updated | amDateFormat:'ll'}}":"Last modified {{room.updated | amDateFormat:'ll'}}","Laatste online":"Latest online",Leuven:"Leuven","Like ons op facebook!":"Like us on facebook!","Maak een account aan":"Create an account","Maak een afspraak":"Make an appointment",Maandelijks:"Monthly","Maximum 8 afbeeldingen per ruimte":"Maximum 8 pictures per space","Meer details":"More info","Met amper twee klikken kan je een afspraak maken met een huisbaas. Geen tijd te verliezen!":"With just two clicks you can make an appointment with a landlord. No time to lose!","Met hoeveel mensen wil je samenwonen?":"With how many others do you want to live together?","Mijn advertenties":"My advertisements","Mijn profiel":"My profile","Mijn wishlist":"My wishlist","Misbruik melden":"Report abuse","Nieuw wachtwoord":"New password","Nieuw wachtwoord aanvragen":"Get new password","Nieuwe account":"New account","Nog geen data beschikbaar":"No data available","Om verder te gaan moet je je registreren of inloggen met een bestaande account":"To continue you need to register or login with an existing account","Onmiddelijk beschikbaar":"Available immediately","Onmiddelijk beschikbaar!":"Available immediately!","Ontdek prachtige woningen overal in België en Nederland":"DIscover beautiful accomodations in Belgium and the Netherlands","Ontstaan uit de site":"Born from the site",Oppervlakte:"Surface","Oppervlakte in m&sup2;":"Surface in m&sup2;","Oppervlakte in m²":"Surface in m²","Over ons":"About us","Plaats je advertentie met slechts enkele klikken gratis online":"Place your ad online with just a few clicks","Populaire steden":"Popular cities","Praat en stel vragen met de huisbazen alsof ze naast jou zaten. Krijg vliegensvlug een antwoord.":"Chat and ask questions with the landlords as if they were sitting next to you. Get an answer on the fly.","Praat onmiddelijk met een eigenaar indien je geïnteresseerd bent":"Immediately talk to the owner if you are interested","Profiel aanpassen":"Edit profile","Reeds vertrouwd door meer dan 1000 huisbazen.":"Already trusted by more than 1000 landlords.",Registreren:"Register","Roken toegelaten":"Smoking allowed",Samenwonen:"Cohabit","Schoonmaak (optioneel)":"Cleaning (optional)","Schoonmaak kosten":"Cleaning costs","Snel. Simpel. Gemakkelijk.":"Fast. Simple. Easy.","Stap 1: meld je aan":"Step 1: log in","Stap 2: maak een advertentie":"Step 2: create your ad","Stap 3: pas ze aan":"Step 3: modify it",Statistieken:"Statistics",Student:"Student","Stuur een bericht":"Send a message",TV:"TV","Taal selecteren":"Select language",Terras:"Terrace","Terug naar kaart":"Back to map",'Titel <i class="icon-info-circled" tooltip="Gebruik voor de titel enkele kernwoorden die onmiddelijk je advertentie beschrijven. Je kan in de beschrijving meer uitleg geven."></i>':'Title <i class="icon-info-circled" tooltip="Choose some good keywords for the title."></i>',"Toegevoegd aan favorieten!":"Added to favorites!","Typ het wachtwoord opnieuw":"Type the password again","Typ je bericht":"Type your message","Type ruimte":"Room type","Type wachtwoord opnieuw":"Type your password again",Uitloggen:"Log out",Upgraden:"Upgrade","Vergelijkbare advertenties":"Similar rooms","Verwijder deze advertentie":"Remove this ad",Verzend:"Send","Volledig huis":"House",Voornaam:"First name",Voorzieningen:"Amenities","Vragen over deze ruimte?":"Questions about this ad?","Vul je email in":"Enter your email","Waar wil je iets huren?":"Where do you want to rent something?",Wachtwoord:"Password","Wachtwoord opnieuw instellen":"Reset password","Wachtwoord vergeten?":"Forgot password?",Weergaven:"Views","Welkom bij":"Welcome to","Wie zijn we":"Who we are","Zoek je andere personen om met je mee samen te wonen in deze ruimte?":"Are you looking for other people to live in this place with you?",Zoeken:"Search","Zoekopdracht verfijnen":"Refine search","aantal contacten per dag":"total amount of messages per day","aantal keer bekeken per dag":"views per day","bekijk de advertentie":"view this ad","hou me op de hoogte van nieuwe aanbiedingen":"keep me informed of new offers",huurcontract:"lease",of:"of",onderverhuring:"sublease",opgeslaan:"saved","per drie maand":"quarterly","per jaar":"per year","per maand":"per month",tot:"till","totaal aantal favorieten per dag":"total amount of favorites per day",van:"of","voorbeeld@email.com":"example@email.com","voorbeeld@gmail.com":"example@gmail.com",wachtwoord:"password","zoek op een nieuwe en makkelijke manier je toekomstige":"find in a new and easy way your ideal","{{::otherRooms.length}} andere ruimte(n) in deze woning":"{{::otherRooms.length}} other rooms in this house","{{room.pictures.length}} foto's":"{{room.pictures.length}} pictures","Bekijk al je contacten met hurders op één plaats":"View all your contacts with tenants in one place","Ga naar de homepagina":"Go to the homepage","Hier zijn alvast enkele vergelijkbare advertenties die we gevonden hebben voor jou:":"Here are some similar ads for you:","Sorry, deze advertentie is momenteel offline gehaald door de eigenaar. Dit kan betekenen dat deze al verhuurd is.":"Sorry, this ad has been taken offline by the owner. This may mean that it is already rented out.","1Roof - Vind je nieuwe woonst":"1Roof - Find your new place to live","Advertentie toevoegen":"Add a room",Kamer:"Room","Ontdek prachtige woningen overal in België":"Discover beautiful homes throughout Belgium","Afspraken.":"Appointments.","Bekijk al je contacten met hurders op één plaats.":"View all your contacts with tenants in one place.","Bekijk gedetailleerde statistieken over je advertentie.":"View detailed statistics of your ads.","Berichten.":"Messages.","Bewaar de leukste aanbiedingen één plaats zodat je de beste er uit kan kiezen.":"Save your preferred ads in one place so it's easier to make a decision.","Chatten.":"Chat.","Favorieten.":"Favorites.","Gratis.":"Free.","Je kan met één klik een afspraak maken met een huisbaas.":"Make an appointment with a landlord with just one click. ","Plaats je advertentie met slechts enkele klikken gratis online.":"Post your ad in just a few clicks online for free .","Praat onmiddelijk met een eigenaar indien je geïnteresseerd bent.":"Immediately talk to the owner.","Statistieken.":"Statistics.",appartement:"appartment",garagebox:"garage",huis:"house",kamer:"room",kot:"room",villa:"villa","Aanbieden.":"Add a space.","Met slechts enkele klikken kan je je advertentie onlne plaatsen.":"You can place this ad online","Ontdek prachtige accomodaties overal in België":"Discover beautiful homes everywhere in Belgium","{{results.length}} advertentie(s) gevonden":"{{results.length}} ads found",'Welkom bij <span class="light">1roof</span>':'Welcome to <span class="light">1roof</span>',"zoekt huisgenoot":"looking for roommate","Heb je een vraag, zit je met iets of wil je gewoon iets kwijt? Aarzel dan niet om ons te contacteren.":"Have a question, wondering about something or just want to say something? Please do not hesitate to contact us.","Neem contact op":"Contact us",Analytics:"Analytics",Impressies:"Impressions","andere(n) in dit pand":"other(s) in this premises","Meer over ons":"More about us","Meldingen.":"Notifications.",kantoor:"office",woning:"home","Meer info":"More info","Foto's zijn het eerste waar iemand op let. Zorg er voor dus dat je veel en duidelijke foto's hebt! Op deze manier zal je advertentie veel sneller verhuurd worden!":"Photos are the first thing that someone pays attention to. Make sure that you have alot clear images! This way your ad will be leased much faster!",Ga:"Go","Meer informatie":"More information",Titel:"Title"})}]),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("promote"),ApplicationConfiguration.registerModule("rooms"),ApplicationConfiguration.registerModule("search"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["AnalyticsProvider",function(a){a.setAccount("UA-54653288-1"),a.trackPages(!0),a.useAnalytics(!0),a.setPageEvent("$stateChangeSuccess")}]).run(["$window","Meta",function(a,b){b.init(),a.L.mapbox.accessToken="pk.eyJ1IjoiZGVmcmVlayIsImEiOiJzN2k4MTJ3In0.T9XzqH8K6OPNRmPXCopzXw"}]),angular.module("core").config(["MetaProvider",function(a){a.when("/about",{title:"Over ons",description:"Meer informatie over 1roof"}).otherwise({title:"1Roof - Vind je nieuwe woonst",description:"Zoek tussen alle huurwoningen in België en Nederland. Vind de panden met beste prijs/kwaliteit. Zie echte fotos van oplijstingen.",image:"https://1roof.be/modules/core/img/brand/logo_big.png"})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"/modules/core/views/home.client.view.html"}).state("pricing",{url:"/pricing?coupon",params:{message:{value:null},coupon:{value:null}},templateUrl:"/modules/core/views/pricing.client.view.html"}).state("about",{url:"/about",templateUrl:"/modules/core/views/about.client.view.html"}).state("privacy",{url:"/privacy",templateUrl:"/modules/core/views/privacy.client.view.html"})}]),angular.module("core").controller("FooterController",["$scope","$rootScope","Rooms","gettext",function(a,b,c,d){a.init=function(){a.latestRooms=c.getLatestRooms({limit:4})},a.getImageLink=function(a){return"cloudinary"===a.provider?"https://res.cloudinary.com/dv8yfamzc/image/upload/w_200,h_200,c_fill/"+a.link+".jpg":a.link},a.getClasification=function(a){var b=a.classification;return d("room"===b?"Kot":"appartment"===b?"Appartement":"Huis")},a.getCurrentYear=function(){return(new Date).getFullYear()}}]),angular.module("core").controller("HeaderController",["$rootScope","$scope","$stateParams","$location","$modal","$http","$interval","Authentication","Geocoder","Modal","gettextCatalog","Socket","amMoment","$state","Analytics","localStorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){h.user&&(l.emit("join",h.user._id),l.on("newMessageCount",function(a){c.inboxId&&c.inboxId===a.inbox||(b.unreadMessageCount=+b.unreadMessageCount+a.count,b.unreadMessageCount<0&&(b.unreadMessageCount=0),r())}),a.$on("inbox_read",function(a,c){c>0&&(b.unreadMessageCount-=c),b.unreadMessageCount<0&&(b.unreadMessageCount=0)}))}function r(){new Audio("/modules/core/img/woosh.wav").play()}function s(a,c,e){b.search.input="",b.search.details={},d.path("/search/"+a).search("lat",c).search("lng",e).search("proximity",3600)}function t(){if(d.search().lang)a.language=d.search().lang,u("en",!1);else{var b=p.get("language");b?(a.language=b,u(b,!1)):(a.language="nl",u("nl",!1))}}function u(a,b){k.setCurrentLanguage(a),m.changeLocale(a),p.set("language",a),b&&n.reload()}b.authentication=h,b.isCollapsed=!0,b.unreadMessageCount=0,b.search={input:"",details:{},autocompleteOptions:{types:"(cities)",country:"be"}},b.init=function(){b.isHomepage="/"===document.location.pathname,t(),a.$watch("language",function(a,b){a!==b&&u(a,!0)}),a.$on("$locationChangeSuccess",function(){b.isCollapsed=!0,b.isHomepage="/"===document.location.pathname,-1!==document.location.pathname.indexOf("/search")?a.hideFooter=!0:a.hideFooter=!1}),a.$on("logged_in",function(){q()}),q()},b.toggleCollapsibleMenu=function(){b.isCollapsed=!b.isCollapsed},b.goToSearch=function(){b.search.details.geometry?s(b.search.input.replace(/, /g,"--"),b.search.details.geometry.location.lat(),b.search.details.geometry.location.lng()):i.geocodeAddress(b.search.input).then(function(a){s(a.formattedAddress.replace(/, /g,"--"),a.lat,a.lng)})},b.openSignupModal=function(){j.signup()},b.openSigninModal=function(){j.signin()},b.getUnreadMessageCount=function(){h.user&&f({method:"GET",url:"/api/users/unreadmessages"}).then(function(a){b.unreadMessageCount=a.data})},b.changeLanguage=function(b,c){a.language=b,u(b,!0),c.preventDefault(),c.stopPropagation()}}]),angular.module("core").controller("HomeController",["$scope","$location","Authentication","Geocoder","Alert",function(a,b,c,d,e){function f(a,c,d){b.path("search/"+a).search("lat",c).search("lng",d).search("proximity",3600)}a.authentication=c,a.search={input:"",details:{},autocompleteOptions:{types:"(cities)",country:"be"}},a.init=function(){a.htmlReady()},a.goToSearch=function(){a.search.details.geometry?f(a.search.input.replace(/, /g,"--"),a.search.details.geometry.location.lat(),a.search.details.geometry.location.lng()):d.geocodeAddress(a.search.input).then(function(a){f(a.formattedAddress.replace(/, /g,"--"),a.lat,a.lng)}),a.search.details={}}}]),angular.module("rooms").controller("ModalPaymentController",["$rootScope","$scope","$http","$modalInstance","options","Alert","Analytics","gettext",function(a,b,c,d,e,f,g,h){function i(a,e,f){c.post("/api/subscription/choose",{plan:a,card:e,couponCode:f}).success(function(c){d.close(c),b.busy=!1,g.trackEvent("Subscription","Changed",a,f)}).error(function(a){b.busy=!1,d.dismiss({error:!0})})}b.subscriptionPlan=e.plan,b.busy=!1,b.submitPayment=function(a,c){b.busy=!0,c.error?(b.busy=!1,f.add("danger",h("Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw."),5e3)):i(e.plan,c.id,e.couponCode)}}]),angular.module("core").controller("PricingController",["$scope","$location","$stateParams","Authentication","Alert","$http","Modal","Enforcer","Analytics","gettext",function(a,b,c,d,e,f,g,h,i,j){function k(b,c){f.post("/api/subscription/choose",{plan:b,couponCode:c}).success(function(f){d.user=f,e.add("success",j("Je tariefplan is geupdatet!"),5e3),a.busy=!1,i.trackEvent("Subscription","Changed",b,c)}).error(function(){e.add("danger",j("Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw."),5e3),a.busy=!1})}a.authentication=d,a.busy=!1;var l=null;a.init=function(){a.message=c.message,l=c.coupon,a.htmlReady()},a.choosePlan=function(b){a.busy=!0,h.do(function(){d.user&&!d.user.subscription.customerToken?g.payment({plan:b,couponCode:l}).then(function(b){d.user=b,e.add("success",j("Je tariefplan is geupdatet!"),5e3),a.busy=!1},function(b){b&&b.error&&e.add("danger",j("Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw."),5e3),a.busy=!1}):k(b,l)})},a.isCurrentPlan=function(a){return!!d.user&&d.user.subscription.plan===a}}]),angular.module("core").directive("animateElement",["$window","Device",function(a,b){return{restriction:"A",link:function(c,d,e){if(!b.isMobile()){var f,g="fadeInUp";d.css({opacity:"0"}),d.waypoint(function(){f+=100,a.$(this).delay(f).queue(function(b){a.$(this).toggleClass("animated"),a.$(this).toggleClass(g),f=0,b()})},{offset:"90%",triggerOnce:!0})}}}}]),angular.module("core").directive("backImg",[function(){return{restriction:"A",scope:{imgProvider:"@",imgLink:"@",isImg:"@"},link:function(a,b,c){var d="";a.imgProvider&&a.imgLink&&(d="cloudinary"===a.imgProvider?"https://res.cloudinary.com/dv8yfamzc/image/upload/w_800,h_600,c_fill/"+a.imgLink+".jpg":a.imgLink,"true"===a.isImg?b.attr("src",d):b.css({"background-image":"url("+d+")"}))}}}]),angular.module("core").directive("datePicker",["$window",function(a){return{restrict:"A",scope:{startDate:"@",dateModel:"=",minDate:"="},link:function(b,c,d){function e(a){b.dateModel=new Date(a),b.$apply()}b.appendToELement=void 0!==d.appendElement;var f,g={firstDay:1,format:"DD/MM/YYYY",onSelect:e};b.appendToELement?(f=new a.Pikaday(g),c.html(f.el)):(g.field=c[0],f=new a.Pikaday(g)),b.$watch("startDate",function(a,b){a!==b&&f.setDate(new Date(a),!0)}),b.$watch("minDate",function(){var a=new Date(b.minDate);f.setMinDate(a),a>b.dateModel&&f.setDate(a,!0)})}}}]),angular.module("core").directive("guidedTour",["$window",function(a){return{template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"><a href="#" class="close">&times;</a><i class="icon-info-circled"></i> Rondleiding</h3><div class="popover-content"><p class="tour-text"></p><button style="display: none;" class="tour-close btn btn-blue btn-xs pull-right">Sluiten</button><button class="tour-next btn btn-green btn-xs pull-right">Volgende <i class="icon-right-1"></i></button><br></div></div>',restriction:"E",transclude:!0,scope:{connectedElement:"@",step:"@",alignment:"@",guide:"=",onTourEnd:"&"},link:function(b,c,d){function e(){var a=g.position(),c=g.outerWidth(),d=a.top,e=c/2-h.outerWidth()/2+"px";"bottom"===b.alignment?d+=20:"right"===b.alignment?(d=a.top,e=g.outerWidth()+"px"):"bottomleft"===b.alignment&&(h.addClass("bottom"),d+=90,e=a.left),h.css({position:"absolute",top:d,left:e}).addClass("active")}function f(a){a===+b.step?e():h.removeClass("active")}var g=a.$(b.connectedElement),h=c.find(".popover"),i=c.find("button"),j=c.find(".close");b.alignment&&h.addClass(b.alignment),d.laststep&&(h.find(".tour-next").hide(),h.find(".tour-close").show()),b.$watch("guide.step",function(a,b){a!==b&&f(a)}),i.click(function(a){b.guide.step++,b.$apply(),d.laststep&&b.onTourEnd(),a.preventDefault(),a.stopPropagation()}),j.click(function(a){b.onTourEnd(),a.preventDefault(),a.stopPropagation()}),c.find(".tour-text").text(b.content),f(b.guide.step),b.$on("$destroy",function(){i.off("click"),j.off("click")})},controller:function(a,b){b(function(b,c){a.content=b.text()})}}}]),angular.module("core").directive("headerScroll",["$window",function(a){return{restriction:"A",link:function(b,c,d){function e(){a.pageYOffset>=100?c.removeClass("transparent"):c.addClass("transparent")}d.$observe("transparent",function(b){var d="true"===b;c.toggleClass("transparent",d),d?(e(),angular.element(a).bind("scroll.header",function(){e()})):angular.element(a).unbind("scroll.header")})}}}]),angular.module("core").directive("hotKeys",["$document","$rootScope",function(a,b){return{restriction:"A",link:function(c,d,e){a.bind("keydown",function(a){b.$broadcast("keypress",a),b.$broadcast("keypress:"+a.which,a)}),c.$on("$destroy",function(){a.unbind("keydown")})}}}]),angular.module("core").directive("onRepeatDone",[function(){return{restriction:"A",link:function(a,b,c){a.$last&&a.$emit(c.onRepeatDone||"repeat_done",b)}}}]),angular.module("core").directive("responsiveAd",[function(){return{restrict:"A",templateUrl:"/modules/core/views/ads/responsive.client.view.html",controller:function(){(window.adsbygoogle||[]).push({})}}}]),angular.module("core").directive("shareButton",[function(){return{restriction:"A",link:function(a,b,c){var d=c.shareButton;"facebook"===d?b.click(function(a){window.open("//www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),a.preventDefault()}):"twitter"===d?b.click(function(a){window.open("//twitter.com/share?url="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=448"),a.preventDefault()}):"pinterest"===d?b.click(function(a){window.open("//pinterest.com/pin/create/button/?url=S"+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),a.preventDefault()}):"google"===d&&b.click(function(a){window.open("//plus.google.com/share?url="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=359"),a.preventDefault()})}}}]),angular.module("core").directive("videoShuffle",["$window","Device",function(a,b){return{template:'<video class="background-video" id="backgroundVideo" autoplay preload type="" style="opacity:0;" src=""></video><video class="background-video" id="stagingVideo" autoplay preload type="" style="opacity:0;" src=""></video>',restrict:"A",link:function(c,d,e){function f(){var a=k.videoContainer[0].videoHeight,b=k.videoContainer[0].videoWidth,c=d.width(),e=c/(b/a);k.videoContainer.css({width:c,height:e}),k.stagingContainer.css({width:c,height:e}),k.videoContainer.animate({opacity:1},2e3)}function g(){void 0!==k.videoContainer[0].canPlayType&&(k.videoContainer[0].canPlayType("video/webm")?(k.supportedType=".webm",k.videoContainer.attr("type","video/webm;codecs='vp8'")):(k.supportedType=".mp4",k.videoContainer.attr("type","video/mp4;codecs='avc1.42E01E, mp4a.40.2'")),j=a._.shuffle(j),k.videoContainer.attr("src","/modules/core/img/video/"+j[0][0]+k.supportedType),k.videoContainer[0].load(),k.stagingContainer.attr("src","/modules/core/img/video/"+j[1][0]+k.supportedType),k.stagingContainer[0].load(),k.stagingContainer[0].pause(),i=a.setTimeout(function(){h()},j[0][1]))}function h(){i=null;var b=j[1][0],c=j[1][1];j[l+1]?(b=j[l+1][0],c=j[l][1]):(l=1,b=j[1][0],c=j[j.length-1][1]),"0"===k.videoContainer.css("opacity")?(k.videoContainer[0].play(),k.videoContainer.animate({opacity:1},150,function(){k.stagingContainer.animate({opacity:0},0),k.stagingContainer.attr("src","/modules/core/img/video/"+b+k.supportedType),k.stagingContainer[0].load(),k.stagingContainer[0].pause()})):(k.stagingContainer[0].play(),k.stagingContainer.animate({opacity:1},150,function(){k.videoContainer.animate({opacity:0},0),k.videoContainer.attr("src","/modules/core/img/video/"+b+k.supportedType),k.videoContainer[0].load(),k.videoContainer[0].pause()})),l++,i=a.setTimeout(function(){h()},c)}if(b.isMobile())return void d.css({"background-image":"url(/modules/core/img/video/fallback_poster.png)"});var i=null,j=[["bike",9900],["bikefar",4900],["house1",2900],["jonnyskateboard",5900],["kidshouse",1900],["leahdog",4900],["majesticdog",4900],["trackingdriveway",4900],["trackingstreet",3900]],k={videoContainer:d.find("#backgroundVideo"),stagingContainer:d.find("#stagingVideo")},l=2;g(),f(),c.$on("$destroy",function(){clearTimeout(i),k.stagingContainer[0].pause(),k.videoContainer[0].pause()}),angular.element(a).bind("resize",function(){f()})}}}]),angular.module("core").service("Alert",["$rootScope","$timeout",function(a,b){a.alerts=[];var c=this;this.add=function(d,e,f){a.alerts.push({type:d,msg:e,close:function(){c.closeAlert(this)}}),f&&b(function(){c.closeAlert(this)},f)},this.closeAlert=function(b){return this.closeAlertIdx(a.alerts.indexOf(b))},this.closeAlertIdx=function(b){return a.alerts.splice(b,1)}}]),angular.module("core").service("Device",["$window",function(a,b){this.isMobile=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||b.opera),a}}]),angular.module("core").factory("traceService",function(){return{print:printStackTrace}}),angular.module("core").provider("$exceptionHandler",{$get:function(a){return a}}),angular.module("core").factory("exceptionLoggingService",["$log","$window","traceService",function(a,b,c){function d(d,e){a.error.apply(a,arguments);try{var f=d.toString(),g=c.print({e:d});b.$.ajax({type:"POST",url:"/api/logger",contentType:"application/json",data:angular.toJson({url:b.location.href,message:f,type:"exception",stackTrace:g,cause:e||"",agent:navigator.userAgent})})}catch(b){a.warn("Error server-side logging failed"),a.log(b)}}return d}]),angular.module("core").service("Modal",["$modal",function(a){this.signup=function(){var a={templateUrl:"/modules/users/views/modals/signup-modal.client.view.html",controller:"AuthenticationController",windowClass:"small"};return this.showModal(a,{})},this.signin=function(){var a={templateUrl:"/modules/users/views/modals/signin-modal.client.view.html",controller:"AuthenticationController",windowClass:"small"};return this.showModal(a,{})},this.contact=function(a){var b={templateUrl:"/modules/rooms/views/modals/contact-modal.client.view.html",controller:"ModalController",resolve:{modalContent:function(){return a}}};return this.showModal(b,{})},this.reservation=function(a){var b={templateUrl:"/modules/rooms/views/modals/reservation-modal.client.view.html",controller:"ModalController",resolve:{modalContent:function(){return a}}};return this.showModal(b,{})},this.changeAddress=function(a){var b={templateUrl:"/modules/rooms/views/modals/change-address-modal.client.view.html",controller:"ManageRoomController",resolve:{addressDetails:function(){return a}}};return this.showModal(b,{})},this.confirm=function(a){var b={templateUrl:"/modules/core/views/modals/confirm-modal.client.view.html",windowClass:"small",controller:"ModalController",resolve:{modalContent:function(){return a}}};return this.showModal(b,{})},this.payment=function(a){var b={templateUrl:"/modules/core/views/modals/payment-modal.client.view.html",controller:"ModalPaymentController",resolve:{options:function(){return a}}};return this.showModal(b,{})};var b={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"/modules/core/views/modal.client.view.html"},c={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(a,b){return a||(a={}),this.show(a,b)},this.show=function(d,e){var f={},g={};return angular.extend(f,b,d),angular.extend(g,c,e),f.controller||(f.controller=function(a,b){a.modalOptions=g,a.modalOptions.ok=function(a){b.close(a)},a.modalOptions.close=function(a){b.dismiss("cancel")}}),a.open(f).result}}]),angular.module("core").factory("Socket",["socketFactory",function(a){return a()}]),angular.module("core").service("Statistics",["$http","localStorageService",function(a,b){function c(b,c){a.post("/api/statistics/"+b+"/aggregate",{type:c})}this.aggregate=function(a,b){c(a,b)}}]),angular.module("promote").config(["$stateProvider",function(a){a.state("promote",{url:"/promote",templateUrl:"/modules/promote/views/promote.client.view.html"})}]),angular.module("promote").config(["MetaProvider",function(a){a.when("/promote",{title:"Je bedrijf adverteren"})}]),angular.module("promote").controller("PromoteController",["$scope","Authentication",function(a,b){a.authentication=b,a.init=function(){a.htmlReady()}}]),angular.module("promote").factory("Ads",["$resource",function(a){return a("/api/ads/:adId",{adId:"@_id"},{update:{method:"PUT"}})}]),angular.module("rooms").config(["MetaProvider",function(a){a.when("/rooms/new",{title:"Advertentie toevoegen"}).when("/rooms/:roomId/edit/:nav",{title:"Advertentie aanpassen"}).when("/rooms/:roomId/analytics",{title:"Analytics bekijken"}).when("/rooms/notfound",{title:"Niet gevonden"})}]),angular.module("rooms").config(["$stateProvider",function(a){a.state("createRoom",{url:"/rooms/new",templateUrl:"/modules/rooms/views/create-room.client.view.html"}).state("viewRoom",{url:"/l/:roomId/:city/:title",templateUrl:"/modules/rooms/views/view-room.client.view.html"}).state("editRoom",{url:"/rooms/:roomId/edit/:nav",templateUrl:"/modules/rooms/views/edit-room.client.view.html"}).state("analytics",{url:"/rooms/:roomId/analytics",templateUrl:"/modules/rooms/views/analytics.client.view.html"}).state("notFound",{url:"/rooms/notfound",templateUrl:"/modules/rooms/views/not-found.client.view.html"})}]),angular.module("rooms").controller("AnalyticsController",["$scope","$location","$http","$stateParams","Authentication","Rooms",function(a,b,c,d,e,f){function g(){c.get("/api/statistics/"+a.room._id+"/lastmonth").success(function(b){a.statisticsData=b,a.htmlReady()})}a.authentication=e,a.statisticsData=[],e.user||b.path("/"),a.init=function(){a.findOne()},a.findOne=function(){a.room=f.get({roomId:d.roomId},g)}}]),angular.module("rooms").controller("CreateRoomController",["$rootScope","$scope","$location","$state","Authentication","Rooms","Modal","Geocoder","$http","Analytics","Alert","gettext",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){h.geocodeAddress(a).then(function(a){a.accuracy<7||(b.addressDetails={street:a.street+" "+a.streetNumber,city:a.city,country:a.country,geo:[a.lng,a.lat]},b.create())})}b.authentication=e,b.createForm={address:"",roomType:""},b.autocompleteOptions={country:"be",watchEnter:!0},b.addressDetails=null,b.creationStep=1,b.busy=!1,b.allowed=!0,b.init=function(){e.user&&(b.creationStep=2),a.$on("logged_in",function(a){b.creationStep=2}),b.htmlReady()},b.create=function(){if(b.busy=!0,b.createForm.roomType){if(null===b.addressDetails)return void m(b.createForm.address);new f({location:{street:b.addressDetails.street,city:b.addressDetails.city,country:b.addressDetails.country},loc:{type:"Point",coordinates:b.addressDetails.geo},classification:b.createForm.roomType}).$save(function(a){j.trackEvent("Room","Created","success"),c.path("/rooms/"+a._id+"/edit/")},function(a){j.trackEvent("Room","Created","failure"),k.add("danger",l("Er is iets misgelopen met het opslaan van de advertentie, probeer later opnieuw."),5e3),b.busy=!1})}},b.openSingupModal=function(){g.signup().then(function(){b.creationStep=2})},b.openSinginModal=function(){g.signin().then(function(){b.creationStep=2})}}]),angular.module("rooms").controller("ManageRoomController",["$scope","$stateParams","$location","Authentication","Rooms","UserSettings","$window","Amenity","$upload","$http","Modal","Alert","gettext",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){a.room.user._id!==d.user._id&&c.path("/"),o()}function o(){function b(){return{visible:a.room.visible,pictures:a.room.pictures,leaseType:a.room.leaseType,available:a.room.available,loc:a.room.loc,location:a.room.location,info:a.room.info,amenities:a.room.amenities,price:a.room.price,surface:a.room.surface,cohabit:a.room.cohabit}}a.$broadcast("room_loaded",a.room),p();var c=g._.debounce(a.update,800);a.$watch(b,function(b,d){b===d||a.busy||(p(),c())},!0)}function p(){var b=[];a.room.info.title&&""!==a.room.info.title.trim()||b.push("general"),(!a.room.price.base||a.room.price.base<=0)&&b.push("costs"),!a.room.available.immediately&&(!a.room.available.from||!a.room.available.till||new Date(a.room.available.till))<new Date&&b.push("availability"),a.errors=b}function q(b){8!==a.room.pictures.length&&(a.busy=!0,i.upload({url:"/api/rooms/"+a.room._id+"/upload",file:b}).success(function(b){a.room.pictures.push({provider:"cloudinary",link:b.id}),a.busy=!1}).error(function(b){a.busy=!1,l.add("danger",m("Er was een probleem bij het toevoegen van de afbeelding, probeer later eens opnieuw."),5e3)}))}function r(b,c){8!==a.room.pictures.length&&(a.busy=!0,c.forEach(function(b){j.post("/api/rooms/"+a.room._id+"/upload",{link:b.link}).success(function(b){a.room.pictures.push({provider:"cloudinary",link:b.id}),a.busy=!1}).error(function(b){a.busy=!1,l.add("danger",m("Er was een probleem bij het toevoegen van de afbeelding, probeer later eens opnieuw."),5e3)})}))}function s(){a.$broadcast("blink_text")}a.authentication=d,a.busy=!1,a.nav="general",a.amenities=h.list(),a.errors=[],a.newAddress="",a.newAddressDetails={},a.guide={enabled:!d.user||d.user.settings.tutorial,step:1},a.init=function(){if(b.nav&&(a.nav=b.nav),!d.user||!b.roomId)return void c.path("/");a.room=e.get({roomId:b.roomId},n,function(){c.path("/dashboard/rooms")}),a.$on("dropbox_chosen",r),a.htmlReady()},a.guideEnded=function(){a.guide.enabled=!1,f.set("tutorial",!1),a.$apply()},a.update=function(){a.room.$update(function(){s()},function(a){l.add("danger",m("Er was een probleem bij het opslaan van je wijzigingen, probeer later opnieuw."),5e3)})},a.onImageSelect=function(b){a.busy=!0,b.length>0&&q(b[0])},a.removeImage=function(b){a.busy=!0,j.post("/api/rooms/"+a.room._id+"/removepicture",{index:b}).success(function(c){a.room.pictures.splice(b,1),a.busy=!1}).error(function(b){l.add("danger",m("Er was een probleem bij het verwijderen van de afbeelding, probeer later opnieuw."),5e3),a.busy=!1})},a.toggleAmenitySelection=function(b){var c=a.room.amenities.indexOf(b);c>-1?a.room.amenities.splice(c,1):a.room.amenities.push(b)},a.isAmenityChecked=function(b){return!!a.room.amenities&&-1!==a.room.amenities.indexOf(b)},a.setTab=function(b){a.nav=b,c.path("/rooms/"+a.room._id+"/edit/"+b)},a.tabHasError=function(b){return-1!==a.errors.indexOf(b)},a.openAddressModal=function(){var b={newAddress:a.newAddress,newAddressDetails:a.newAddressDetails};k.changeAddress(b).then(function(b){a.room.location={street:b.street+" "+b.streetNumber,city:b.city,country:b.country},a.room.loc={type:"Point",coordinates:b.geo},a.$broadcast("room_loaded",a.room)})},a.visibilityText=function(a){return a?"online":"offline"},a.deleteRoom=function(){k.confirm("room").then(function(){a.room.$remove(function(){c.path("/dashboard/rooms")})})}}]),angular.module("rooms").controller("ModalController",["$scope","$modalInstance","modalContent",function(a,b,c){a.modalContent=c}]),angular.module("rooms").controller("RoomsController",["$rootScope","$scope","$stateParams","$http","Authentication","Rooms","Amenity","Modal","Alert","Statistics","Meta","$location","Enforcer","Analytics","gettext",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){return!b.room.visible&&(null===e.user||b.room.user._id!==e.user._id)}function q(){d.post("/api/rooms/"+b.room._id+"/favorite").success(function(a){var c=e.user.favorites.indexOf(b.room._id);-1===c?(j.aggregate(b.room._id,"favorites"),e.user.favorites.push(b.room._id),i.add("success",o("Toegevoegd aan favorieten!"),3e3),n.trackEvent("Room","Favorite")):e.user.favorites.splice(c,1)}).error(function(a){i.add("danger",o("Er was een probleem bij het toevoegen aan je favorieten, probeer later eens opnieuw."),5e3)})}function r(a){j.aggregate(b.room._id,"messages"),d.post("/api/rooms/"+b.room._id+"/message",{message:a}).success(function(a){i.add("success",o("Je bericht is verzonden!"),5e3),n.trackEvent("Room","Message")}).error(function(a){i.add("danger",o("Er was een probleem met het verzenden van je bericht, probeer later eens opnieuw."),5e3)})}function s(a){j.aggregate(b.room._id,"reservations"),d.post("/api/rooms/"+b.room._id+"/message",{message:b.appointmentDate.getTime(),messageType:"reservation"}).success(function(b){a?r(a):i.add("success","Je aanvraag is verzonden!",5e3),n.trackEvent("Room","Reservation")}).error(function(a){i.add("danger",o("Er was een probleem met het verzenden van je bericht, probeer later eens opnieuw."),5e3)})}function t(){k.add("/l/:roomId/:city/:title",u()),j.aggregate(b.room._id,"views"),b.otherRooms=f.getRoomsOfSameLocation({roomId:b.room._id}),b.similarRooms=f.getSimilarRooms({roomId:b.room._id}),b.$broadcast("room_loaded",b.room),0===b.room.pictures.length&&b.$emit("pictures_rendered"),b.showOfflineModal=p(),b.htmlReady()}function u(){var a={};if(b.room.info.title?(a.title=b.room.info.title+" | "+b.room.location.city,a.description=b.room.info.description.replace(/(\r\n|\n|\r)/gm," ")):a.title=b.room.location.street,b.room.pictures.length>0){var c=b.room.pictures[0];"cloudinary"===c.provider?a.image="http://res.cloudinary.com/dv8yfamzc/image/upload/"+c.link+".jpg":a.image=c.link}return a}function v(a){404===a.status&&l.path("/rooms/notfound")}b.authentication=e,b.contactInfo={appointmentDate:new Date,name:"",email:""},b.currentDate=new Date,b.appointmentDate=new Date,b.otherRooms=[],b.similarRooms=[],b.amenities=g.list(),b.isOverlay=!1,b.showCostsDetails=!1,b.showOfflineModal=!1,b.init=function(){b.findOne()},b.findOne=function(){b.room=f.get({roomId:c.roomId},t,v)},b.isAmenityChecked=function(a,c){return!!b.room.amenities&&-1!==a.amenities.indexOf(c.value)},b.openReservationModal=function(){m.do(function(){h.reservation(b.appointmentDate).then(s)})},b.openContactModal=function(){m.do(function(){h.contact(b.contactInfo).then(r)})},b.toggleFavorite=function(){m.do(function(){q()})},b.isInfavorites=function(){return!!e.user&&-1!==e.user.favorites.indexOf(b.room._id)},b.closeOverlay=function(){a.$broadcast("close_overlay")},b.isOverlay=function(){return c.isOverlay},b.visibilityText=function(a){return a?"online":"offline"},b.setVisibility=function(){d.put("/api/rooms/"+b.room._id,{visible:b.room.visible})},b.getNumber=function(a){for(var b=[],c=0;c<a;c++)b.push(c);return b},b.getCostPeriod=function(a){return o("month"===a?"per maand":"month"===a?"per drie maand":"per jaar")},b.getClasification=function(a){var b=a.classification;return o("room"===b?"Kot":"appartment"===b?"Appartement":"Huis")},b.getImageLink=function(a){return"cloudinary"===a.provider?"https://res.cloudinary.com/dv8yfamzc/image/upload/w_300,h_300,c_fill/"+a.link+".jpg":a.link}}]),angular.module("rooms").directive("addressLookup",["$window","Geocoder",function(a,b){return{restrict:"A",scope:{resultObject:"="},require:"^form",link:function(c,d,e,f){function g(a){b.geocodeAddress(a).then(function(a){d.val(a.formattedAddress),c.resultObject={street:a.street,streetNumber:a.streetNumber,city:a.city,country:a.country,geo:[a.lng,a.lat]},i()})}function h(a){for(var b="",d="",e="",f="",g=0;g<a.address_components.length;g++){switch(a.address_components[g].types[0]){case"street_number":b=a.address_components[g].long_name;break;case"route":d=a.address_components[g].long_name;break;case"locality":e=a.address_components[g].long_name;break;case"country":f=a.address_components[g].long_name}}c.resultObject={street:d,streetNumber:b,city:e,country:f,geo:[a.geometry.location.lng(),a.geometry.location.lat()]},i()}function i(){c.resultObject.street&&""!==c.resultObject.street?f.$setValidity("noStreet",!0):f.$setValidity("noStreet",!1),c.resultObject.streetNumber&&""!==c.resultObject.streetNumber?f.$setValidity("noStreetNumber",!0):f.$setValidity("noStreetNumber",!1)}f.$setValidity("",!1);var j=new a.google.maps.places.Autocomplete(d[0],{types:["geocode"]});a.google.maps.event.addListener(j,"place_changed",function(){var a=j.getPlace();a.address_components?h(a):g(a.name)})}}}]),angular.module("core").directive("addthisToolbox",["$window",function(a){return{restrict:"A",transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(b,c,d){addthis&&(addthis.init(),addthis.toolbox(a.$(c).get()))}}}]),angular.module("core").directive("blinkText",[function(){return{restrict:"A",link:function(a,b,c){a.$on("blink_text",function(a){b.finish().show().fadeOut(1400)})}}}]),angular.module("rooms").directive("owlCarousel",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e,f={autoPlay:!1,slideSpeed:200,paginationSpeed:600,rewindSpeed:800,stopOnHover:!0,navigation:!0,pagination:"true"===d.owlPagination,rewindNav:!0,singleItem:!0,autoHeight:!1,lazyLoad:!1,mouseDrag:!1,navigationText:['<i class="icon-left-open-mini"></i>','<i class="icon-right-open-mini"></i>']},g=a.$(c);b.$on("pictures_rendered",function(){e=g.owlCarousel(f).data("owlCarousel")}),b.$on("$destroy",function(){e&&e.destroy()})}}}]),angular.module("rooms").directive("checkAddress",[function(){return{restrict:"A",link:function(a,b,c,d){a.createRoomForm.$setValidity("input",!1),a.$watch("autoCompleteDetails",function(b,c){if(b){a.createRoomForm.$setValidity("input",!0);for(var d="",e="",f="",g="",h=0;h<b.address_components.length;h++){switch(b.address_components[h].types[0]){case"street_number":d=b.address_components[h].long_name;break;case"route":e=b.address_components[h].long_name;break;case"locality":f=b.address_components[h].long_name;break;case"country":g=b.address_components[h].long_name}}""===e?a.createRoomForm.$setValidity("noStreet",!1):a.createRoomForm.$setValidity("noStreet",!0),""===d?a.createRoomForm.$setValidity("noStreetNumber",!1):a.createRoomForm.$setValidity("noStreetNumber",!0),a.createRoomForm.$valid&&(a.addressDetails={street:e+" "+d,city:f,country:g,geo:[b.geometry.location.lng(),b.geometry.location.lat()]})}})}}}]),angular.module("core").directive("dropboxChooser",["$window",function(a){return{restrict:"A",scope:{chooserSuccess:"&"},link:function(b,c,d){var e={success:function(a){b.$emit("dropbox_chosen",a)},linkType:"direct",multiselect:!1,extensions:["images"]};c.click(function(){a.Dropbox.choose(e)})}}}]),angular.module("core").directive("limitText",[function(){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel"},link:function(a,b,c){a.$watch("model",function(b,d){b!==d&&a.model&&(a.model=a.model.substring(0,c.limitText))})}}}]),angular.module("rooms").directive("roomMap",["$window",function(a){return{template:'<div id="map" class="map-canvas"></div>',restrict:"A",link:function(b,c,d){function e(a){return"room"===a?"lodging":"appartment"===a?"commercial":"building"}var f=null,g=a.L.mapbox.map(c[0],"defreek.j27p0821",{zoomControl:!1});b.$on("room_loaded",function(b,c){g.setView([c.loc.coordinates[1],c.loc.coordinates[0]],15),g.dragging.disable(),g.touchZoom.disable(),g.doubleClickZoom.disable(),g.scrollWheelZoom.disable(),g.tap&&g.tap.disable(),f&&f.clearLayers(),f=a.L.mapbox.featureLayer({type:"Feature",geometry:c.loc,properties:{"marker-size":"medium","marker-color":"#f44","marker-symbol":e(c.classification)}}).addTo(g)}),b.$on("$destroy",function(){g.remove()})}}}]),angular.module("core").directive("statisticsChart",["$window",function(a){return{restriction:"E",require:"ngModel",scope:{model:"=ngModel"},link:function(b,c,d){function e(a,b){var c=g.time.day.range(a,b),d=[];return c.forEach(function(a){var b={date:new Date(a.getFullYear(),a.getMonth(),a.getDate())};b[h]=0,d.push(b)}),d}function f(a){var b={top:20,right:30,bottom:30,left:30},d=c.parent().outerWidth()-b.left-b.right-55,e=200-b.top-b.bottom,f=g.time.scale().range([0,d]),i=g.scale.linear().range([e,0]),j=g.svg.axis().scale(f).orient("bottom"),k=g.svg.axis().scale(i).orient("left").tickSize(-d).ticks(5).tickFormat(g.format("d")),l=function(a){return new Date(a.date)},m=function(a){return+a[h]},n=g.svg.line().x(function(a){return f(l(a))}).y(function(a){return i(m(a))}).interpolate("monotone"),o=g.select(c[0]).append("svg").attr("width",d+b.left+b.right).attr("height",e+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")");f.domain(g.extent(a,l)),i.domain(g.extent(a,m)),o.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(j),o.append("g").attr("class","y axis").call(k),o.append("path").datum(a).attr("class","line").attr("d",n),o.append("g").selectAll("circle").data(a).enter().append("circle").attr("class","data-point").attr("cx",function(a){return f(l(a))}).attr("cy",function(a){return i(m(a))}).attr("r",3.5)}var g=a.d3,h=d.value,i=new Date;i=i.setDate(i.getDate()-30);var j=e(i,new Date);d.aggregate;b.$watch("model",function(b){if(b.length>0){b.forEach(function(a){var b=new Date(a.date);a.date=new Date(b.getFullYear(),b.getMonth(),b.getDate())});f(a._.chain(a._.extend(j,b)).sortBy(function(a){return new Date(a.date).getTime()}).uniq(function(a){return new Date(a.date).getTime()}).forEach(function(a){a[h]||(a[h]=0)}).value())}})}}}]),angular.module("rooms").directive("streetView",["$window",function(a,b){return{scope:{center:"=mapCenter"},template:"<div></div>",restrict:"A",link:function(b,c,d){b.$on("room_loaded",function(b,d){function e(a,b,c){a.setPosition(b),a.setPov({heading:c,zoom:1,pitch:0}),a.setVisible(!0)}var f=d.loc.coordinates,g=new a.google.maps.LatLng(f[1],f[0]),h=new a.google.maps.StreetViewPanorama(c[0],{zoomControl:!1,position:g,pov:{heading:0,pitch:0,zoom:1}});(new a.google.maps.StreetViewService).getPanoramaByLocation(g,50,function(b,c){if(c===a.google.maps.StreetViewStatus.OK){var d=g;g=b.location.latLng;var f=a.google.maps.geometry.spherical.computeHeading(g,d);e(h,g,f)}})})}}}]),angular.module("rooms").factory("Amenity",["gettext",function(a){return{list:function(){return[{name:a("TV"),value:"television"},{name:a("Internet"),value:"internet"},{name:a("Terras"),value:"terrace"},{name:a("Auto garage"),value:"parking"},{name:a("Fietsstalling"),value:"bicycleParking"},{name:a("Dubbel glas"),value:"doubleGlass"},{name:a("Gemeubeld"),value:"furnished"},{name:a("Aparte badkamer"),value:"seperateBathroom"},{name:a("Aparte keuken"),value:"seperateKitchen"},{name:a("Huisdieren toegelaten"),value:"pets"},{name:a("Domicilie verplicht"),value:"domicile"},{name:a("Roken toegelaten"),value:"smoking"}]}}}]),angular.module("rooms").factory("Rooms",["$resource",function(a){return a("/api/rooms/:roomId",{roomId:"@_id"},{update:{method:"PUT"},getLatestRooms:{method:"GET",url:"/api/latestrooms",isArray:!0},getMyRooms:{method:"GET",url:"/api/myrooms",isArray:!0},getRoomsOfSameLocation:{method:"GET",url:"/api/rooms/:roomId/same",isArray:!0},getSimilarRooms:{method:"GET",url:"/api/rooms/:roomId/similar",isArray:!0}})}]),angular.module("search").config(["MetaProvider",function(a){a.when("/search/:address",{title:"Huur een appartement, huis of kot in :address",description:"Krijg een overzicht van alle appartementen, huizen, koten en nog veel meer in :address."})}]),angular.module("search").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("search",{url:"/search/:address",templateUrl:"/modules/search/views/search.client.view.html"}).state("search.overlay",{url:"/rooms/:roomId/:isOverlay",templateUrl:"/modules/rooms/views/view-room.client.view.html"}),b.deferIntercept()}]).run(["$rootScope","$urlRouter","Device",function(a,b,c){function d(){}var e=c.isMobile();a.$on("$locationChangeSuccess",function(a,c,f){a.preventDefault(),e||-1===f.indexOf("/search/")||-1===c.indexOf("/l/")?b.sync():d(),b.listen()})}]),angular.module("search").controller("SearchController",["$rootScope","$scope","$timeout","$location","$state","$stateParams","Geocoder","Rooms","$window","Authentication","localStorageService","Enforcer","UserSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){a.lat&&a.lng&&(b.filter.location=[parseFloat(a.lng),parseFloat(a.lat)]),a.proximity&&(b.filter.proximity=a.proximity),a.minPrice&&(b.filter.minPrice=+a.price),a.maxPrice&&(b.filter.maxPrice=+a.maxPrice),a.roomType&&(b.filter.roomType=a.roomType),a.size&&(b.filter.size=+a.size),a.amneties&&(b.filter.amneties=a.amneties)}function o(a){g.geocodeAddress(a.replace("--"," ")).then(function(a){b.mapCenter=[a.lng,a.lat],b.filter.location=[a.lng,a.lat],""===d.search()._escaped_fragment_&&s()})}function p(){return b.selectedRoomId?i._.indexOf(i._.pluck(b.results,"_id"),b.selectedRoomId):-1}function q(){var a=p();if(-1!==a&&a>0){var c=b.results[a-1];b.selectRoom(c._id,c.url)}}function r(){var a=p();if(-1!==a&&a<b.results.length-1){var c=b.results[a+1];b.selectRoom(c._id,c.url)}}function s(){b.busy=!0,h.query(b.filter,function(a){var c=b.results,d=a,e=c.map(function(a){return a._id}),f=d.map(function(a){return a._id}),g=i._.difference(e,f),h=i._.difference(f,e);c=c.filter(function(a){return!i._.contains(g,a._id)}),d.forEach(function(a){i._.contains(h,a._id)&&c.push(a)}),b.results=c,b.busy=!1,b.htmlReady()},function(){b.results=[],b.busy=!1,b.htmlReady()})}function t(){e.transitionTo("search",f,{reload:!1,location:!1}),w&&(d.url(w),w=null),b.selectedRoomId=null,b.isOverLayOpen=!1}function u(){e.transitionTo("search.overlay",f,{reload:!1,location:!1}),b.$broadcast("close_marker_popups"),b.isOverLayOpen=!0}b.user=j.user,b.mapCenter=[4.35171,50.85034],b.mapZoom=13,b.filter={location:[],proximity:7e3,roomType:[],minPrice:0,maxPrice:2e3,size:null,amenities:[]},b.results=[],b.selectedRoomId=null,b.isOverLayOpen=!1,b.busy=!1;var v=k.get("viewedRooms")||[],w=null;b.init=function(){function c(a){var b=Math.floor(Math.log(20088e3/a)/Math.log(2));return b>19&&(b=19),b<0&&(b=0),b}var e=d.search();a.$watch(function(){return d.path()},function(a,c){-1!==a.indexOf("/search")&&-1!==c.indexOf("/l/")&&(b.selectedRoomId=null)}),b.$watch("filter",function(a,b){a!==b&&x()},!0),e.lat&&e.lng||!f.address?e.lat&&e.lng?(n(e),b.mapCenter=b.filter.location,b.mapZoom=c(b.filter.proximity),s()):(b.mapZoom=9,s()):o(f.address),f.roomId&&(b.selectedRoomId=f.roomId,u()),b.user&&b.user.settings.email.newRooms&&b.updateSettings(),a.$on("close_overlay",t),a.$on("keypress",function(a,b){37===b.which?q():39===b.which&&r()})},b.mapChangedEvent=function(a){b.filter.proximity=a.proximity/2,b.filter.location=[a.lng,a.lat],d.search("lat",a.lat).search("lng",a.lng).search("proximity",b.filter.proximity),c(function(){b.$apply()})},b.toggleAmenitySelection=function(a){var c=b.filter.amenities.indexOf(a);c>-1?b.filter.amenities.splice(c,1):b.filter.amenities.push(a)},b.selectRoom=function(a,c){if(b.selectedRoomId&&b.selectedRoomId===a)b.selectedRoomId=null,t();else{b.selectedRoomId=a,i._.extend(f,{roomId:a,isOverlay:!0});-1!==d.url().indexOf("/search")&&(w=d.url(),d.url(c)),u(),-1===v.indexOf(a)&&v.push(a)}},b.hasSeenRoom=function(a){return-1!==v.indexOf(a)},b.openRoomPopup=function(a){b.$broadcast("open_marker_popup",a)},b.getRoomTypeIcon=function(a){return"room"===a?"lodging":"appartment"===a?"commercial":"building"},b.setRoomType=function(a){return"all"===a?[]:[a]},b.isNewRoom=function(a){return(new Date).getTime()-new Date(a.created).getTime()<864e5},b.updateSettings=function(a){l.do(function(){m.set("alert.filters",{location:b.filter.location,proximity:b.filter.proximity})},function(){a.preventDefault()})};var x=i._.debounce(s,400)}]),angular.module("search").directive("checkboxGroup",["$window",function(a){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel"},link:function(b,c,d){c.children("button").bind("click",function(c){var d=a.$(c.currentTarget),e=d.attr("data-val"),f=b.model.indexOf(e);d.hasClass("active")?(-1!==f&&b.model.splice(f,1),d.removeClass("active")):(-1===f&&b.model.push(e),d.addClass("active")),c.stopPropagation()})}}}]),angular.module("search").directive("mapboxMap",["$compile","$q","$window","$http","$timeout",function(a,b,c,d,e){var f;return{restrict:"E",transclude:!0,replace:!0,scope:{center:"=mapCenter",zoom:"=mapZoom",changedEvent:"=mapChanged",preventPopups:"=",selectRoom:"="},template:'<div class="map-canvas" ng-transclude></div>',link:function(b,g,h){function i(a){b.markers.forEach(function(b){b.roomId===a&&b.openPopup()})}function j(){var a=b.map.getBounds(),c=a.getNorthWest(),d=a.getSouthEast();return Math.floor(c.distanceTo(d))}function k(){var a=b.map.getCenter(),e={client_id:"4I5SHYQHG4OXY2ZCCRTFPNYFVK0U0G4NPLIBKLWGM2SWLPVY",client_secret:"11YEGLXWQBXX4KERSY2CXLMC4E3C2X021DGZLXVVMK0KRWJZ",ll:a.lat+","+a.lng,radius:j(),v:"20140701",categoryId:"4bf58dd8d48988d1ae941735"};d({url:"https://api.foursquare.com/v2/venues/search",method:"GET",params:e}).success(function(a){a.response.venues.forEach(function(a){var b=c.L.latLng(a.location.lat,a.location.lng);c.L.marker(b,{icon:c.L.divIcon({className:"maki-icon college"})}).bindPopup('<a target="_blank" href="https://foursquare.com/v/'+a.id+'">'+a.name+"</a>").addTo(n)})})}var l={minZoom:11};b.map=c.L.mapbox.map(g[0],"defreek.j27p0821",l).setView([b.center[1],b.center[0]],b.zoom),f.resolve(b.map),b.isClusteringMarkers=void 0!==h.clusterMarkers;var m=void 0!==h.scaleToFit;b.fitMapToMarkers=function(){if(m){var a=new c.L.featureGroup(b.markers);b.map.fitBounds(a.getBounds())}};var n=(new c.L.featureGroup).addTo(b.map);b.changedEvent&&b.map.on("moveend",function(a){var c=b.map.getCenter();b.changedEvent({lng:c.lng,lat:c.lat,proximity:j()}),n.clearLayers(),k()}),b.$on("open_marker_popup",function(a,c){b.preventPopups||i(c)}),b.$on("close_marker_popups",function(a){b.markers.forEach(function(a){a.closePopup()})}),b.$watch("center",function(){b.map.setView([b.center[1],b.center[0]],b.zoom)}),b.map.on("popupopen",function(c){var d=angular.element(document.getElementsByClassName("leaflet-popup-content"));a(d)(b),e(function(){b.$apply()})}),b.$on("$destroy",function(){b.map.remove()}),k()},controller:["$scope",function(a){a.markers=[],a.featureLayers=[],f=b.defer(),a.getMap=this.getMap=function(){return f.promise},c.L.MarkerClusterGroup&&(a.clusterGroup=new c.L.MarkerClusterGroup({showCoverageOnHover:!1}),this.getMap().then(function(b){b.addLayer(a.clusterGroup)})),this.$scope=a}]}}]),angular.module("search").directive("mapboxMarker",["$compile","$window",function(a,b){var c={navy:"#001f3f",blue:"#0074d9",aqua:"#7fdbff",teal:"#39cccc",olive:"#3d9970",green:"#2ecc40",lime:"#01ff70",yellow:"#ffdc00",orange:"#ff851b",red:"#ff4136",fuchsia:"#f012be",purple:"#b10dc9",maroon:"#85144b",white:"white",silver:"#dddddd",gray:"#aaaaaa",black:"#111111"};return{restrict:"E",require:"^mapboxMap",transclude:!0,scope:!0,replace:!0,link:function(d,e,f,g,h){function i(a,b){var d=b||{};return a.size&&(d["marker-size"]=a.size),a.color&&("#"===a.color[0]?d["marker-color"]=a.color:d["marker-color"]=c[a.color]||a.color),a.icon&&(d["marker-symbol"]=a.icon),d}var j,k={draggable:void 0!==f.draggable},l=i(f),m=function(a,c,d,e,f){e=e||{};var h=b.L.mapbox.marker.style({properties:f},[c.lat,c.lng]);return d&&d.length>0&&(h.bindPopup(d,{closeButton:!1,minWidth:320}),h.roomId=c.roomId),g.$scope.isClusteringMarkers&&!0!==e.excludeFromClustering?g.$scope.clusterGroup.addLayer(h):h.addTo(a),e.draggable&&h.dragging.enable(),g.$scope.markers.push(h),h},n=function(a,b,c,d){d=i(d,{"marker-color":"#000","marker-symbol":"star"}),c.excludeFromClustering=!0,a.on("locationfound",function(b){j=m(a,[b.latlng.lat,b.latlng.lng],null,c,d)}),a.locate()};g.getMap().then(function(b){setTimeout(function(){for(var c="",i=h(d,function(){}),o=0;o<i.length;o++)void 0!==i[o].outerHTML&&(c+=i[o].outerHTML);if(void 0!==f.currentLocation)n(b,null,k,l);else{if(c){var p=angular.element(c);a(p)(d),d.$$phase||d.$digest();var q="";for(o=0;o<p.length;o++)q+=p[o].outerHTML;j=m(b,f,q,k,l)}else j=m(b,f,null,k,l);e.bind("$destroy",function(){g.$scope.isClusteringMarkers?g.$scope.clusterGroup.removeLayer(j):b.removeLayer(j)})}},0)})}}}]),angular.module("search").directive("radioGroup",["$window","$timeout",function(a,b){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel",outputFunction:"="},link:function(c,d,e){function f(a){c.model=c.outputFunction?c.outputFunction(a):a,b(function(){c.$apply()})}var g=d.children("button");f(d.children("button.active").attr("data-val")),g.bind("click",function(b){var c=a.$(b.currentTarget);c.hasClass("active")||(g.removeClass("active"),c.addClass("active")),f(c.attr("data-val")),b.stopPropagation()})}}}]),angular.module("search").directive("rangeSlider",["$window",function(a){return{restrict:"A",scope:{start:"@",step:"@",end:"@",callback:"@",margin:"@",ngModel:"=",ngFrom:"=",ngTo:"="},link:function(b,c,d){var e,f,g,h,i;return h=a.$(c),e=b.callback?b.callback:"slide",null!==b.ngFrom&&null!==b.ngTo?(f=null,i=null,h.noUiSlider({start:[b.ngFrom||b.start,b.ngTo||b.end],step:parseFloat(b.step||1),connect:!0,margin:parseFloat(b.margin||0),range:{min:[parseFloat(b.start)],max:[parseFloat(b.end)]}}),h.on(e,function(){var a=h.val(),c=a[0],d=a[1];return f=parseFloat(c),i=parseFloat(d),b.$apply(function(){return b.ngFrom=f,b.ngTo=i,i})}),b.$watch("ngFrom",function(a,b){if(a!==f)return h.val([a,null])}),b.$watch("ngTo",function(a,b){if(a!==i)return h.val([null,a])})):(g=null,h.noUiSlider({start:[b.ngModel||b.start],step:parseFloat(b.step||1),range:{min:[parseFloat(b.start)],max:[parseFloat(b.end)]}}),h.on(e,function(){return g=parseFloat(h.val()),b.$apply(function(){return b.ngModel=g,g})}),b.$watch("ngModel",function(a,b){if(a!==g)return h.val(a)}))}}}]),angular.module("core").factory("Geocoder",["localStorageService","$q","$timeout","$rootScope",function(a,b,c,d){var e=a.get("locations")?a.get("locations"):{},f=[],g=250,h=function(){var b=f[0];(new google.maps.Geocoder).geocode({address:b.address},function(i,j){if(j===google.maps.GeocoderStatus.OK){for(var k={lat:i[0].geometry.location.lat(),lng:i[0].geometry.location.lng(),formattedAddress:i[0].formatted_address,accuracy:i[0].address_components.length},l=0;l<i[0].address_components.length;l++)switch(i[0].address_components[l].types[0]){case"street_number":k.streetNumber=i[0].address_components[l].long_name;break;case"route":k.street=i[0].address_components[l].long_name;break;case"locality":k.city=i[0].address_components[l].long_name;break;case"country":k.country=i[0].address_components[l].long_name}e[b.address]=k,a.set("locations",e),f.shift(),b.d.resolve(k)}else j===google.maps.GeocoderStatus.ZERO_RESULTS?(f.shift(),b.d.reject({type:"zero",message:"Zero results for geocoding address "+b.address})):j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?b.executedAfterPause&&(f.shift(),b.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+b.address})):j===google.maps.GeocoderStatus.REQUEST_DENIED?(f.shift(),b.d.reject({type:"denied",message:"Request denied for geocoding address "+b.address})):(f.shift(),b.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+j+", address="+b.address}));if(f.length)if(j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var m=f[0];m.executedAfterPause=!0,c(h,g)}else c(h,0);d.$$phase||d.$apply()})};return{geocodeAddress:function(a){var c=b.defer();return _.has(e,a)?c.resolve(e[a]):(f.push({address:a,d:c}),1===f.length&&h()),c.promise}}}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin")}return a.reject(d)}}}])}]),angular.module("users").config(["MetaProvider",function(a){a.when("/settings/profile",{title:"1Roof - Profiel",description:""}).when("/settings/password",{title:"1Roof - Wachtwoord",description:""}).when("/signup",{title:"1Roof - Registreren",description:""}).when("/signin",{title:"1Roof - Inloggen",description:""}).when("/forgot",{title:"1Roof - Wachtwoord vergeten",description:""}).when("/reset/:token",{title:"1Roof - Wachtwoord resetten",description:""}).when("/dashboard/:nav",{title:"1Roof - Dashboard",description:""}).when("/dashboard/messages/:inboxId",{title:"1Roof - Berichten",description:""}).when("/users/:userId/favorites",{title:"1Roof - Wishlist bekijken",description:""})}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"/modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"/modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"/modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"/modules/users/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"/modules/users/views/signin.client.view.html"}).state("forgot",{url:"/forgot",templateUrl:"/modules/users/views/forgot.client.view.html"}).state("reset",{url:"/reset/:token",templateUrl:"/modules/users/views/reset.client.view.html"}).state("dashboard",{url:"/dashboard/:nav",templateUrl:"/modules/users/views/dashboard.client.view.html"}).state("viewInbox",{url:"/dashboard/messages/:inboxId",templateUrl:"/modules/users/views/inbox.client.view.html",reloadOnSearch:!1}).state("favorites",{url:"/users/:userId/favorites",templateUrl:"/modules/users/views/favorites.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$rootScope","$scope","$stateParams","$http","$location","$q","Authentication","Modal","Alert","gettext",function(a,b,c,d,e,f,g,h,i,j){b.authentication=g,b.busy=!1,b.success=!1,b.authentication.user&&e.path("/"),b.signup=function(){var c=f.defer();b.busy=!0,d.post("/auth/signup",b.credentials).success(function(d){return b.authentication.user=d,b.$close&&b.$close(),c.resolve(),a.$broadcast("logged_in"),b.busy=!1,i.add("success",j("Je account is met succes aangemaakt! Je bent nu ingelogd."),3e3),c.promise}).error(function(a){return a&&a.message&&(b.error=a.message),c.reject(),b.busy=!1,c.promise})},b.signin=function(){var c=f.defer();b.busy=!0,d.post("/auth/signin",b.credentials).success(function(d){return b.authentication.user=d,b.$close&&b.$close(),c.resolve(),a.$broadcast("logged_in"),b.busy=!1,"/signin"===e.path()&&e.path("/dashboard/rooms"),c.promise}).error(function(a){return a&&a.message&&(b.error=a.message),c.reject(),b.busy=!1,c.promise})},b.forgot=function(){b.success=b.error=null,b.busy=!0,d.post("/auth/forgot",b.credentials).success(function(a){b.credentials=null,b.success=!0,b.busy=!1}).error(function(a){b.credentials=null,a&&a.message&&(b.error=a.message),b.busy=!1})},b.reset=function(){b.success=b.error=null,b.busy=!0,d.post("/auth/reset/"+c.token,b.passwordDetails).success(function(a){b.success=!0,b.passwordDetails=null,b.busy=!1}).error(function(a){a&&a.message&&(b.error=a.message),b.busy=!1})},b.openSignupModal=function(){b.$dismiss&&b.$dismiss(),h.signup()},b.openSigninModal=function(){b.$dismiss&&b.$dismiss(),h.signin()}}]),angular.module("users").controller("DashboardController",["$scope","$stateParams","$state","$location","Rooms","Authentication",function(a,b,c,d,e,f){a.authentication=f,a.nav="rooms",f.user||d.path("/signin"),a.init=function(){b.nav&&(a.nav=b.nav),a.htmlReady()},a.getMyRooms=function(){a.myrooms=e.getMyRooms()},a.setTab=function(b){a.nav=b,d.path("/dashboard/"+b)},a.goToRoom=function(a){d.path("/rooms/"+a)},a.visibilityText=function(a){return a?"online":"offline"},a.updateRoom=function(a){a.$update()},a.viewAnalytics=function(a){d.path("/rooms/"+a._id+"/analytics")}}]),angular.module("users").controller("FavoritesController",["$scope","$http","$stateParams","Authentication","Meta",function(a,b,c,d,e){function f(){b.get("/api/users/"+a.user._id+"/favorites").success(function(b){a.favorites=b,a.busy=!1,a.htmlReady()}).error(function(b){a.busy=!1,a.htmlReady()})}a.authentication=d,a.favorites=[],a.busy=!1,a.init=function(){b.get("/api/users/"+c.userId).success(function(b){a.user=b,e.add("/l/:roomId/:city/:title",{title:"Wishlist van "+a.user.displayName}),f()})}}]),angular.module("users").controller("InboxController",["$rootScope","$scope","$location","$http","$stateParams","Inbox","Authentication","Socket","Modal","Alert","gettext",function(a,b,c,d,e,f,g,h,i,j,k){function l(){return g.user||c.path("/signin"),g.user}function m(a){a.messages.forEach(function(a){a.sender!==l()._id&&(a.isRead=!0)}),a.$update()}b.authentication=g,b.newMessage="",b.busy=!1,b.init=function(){l()||c.path("/signin"),b.findOne(e.inboxId),b.inbox.$promise.then(function(a){h.emit("join",a._id)}),b.$on("$destroy",function(){h.emit("leave",b.inbox._id)}),h.on("newMessage",function(a){a.sender!==l()._id&&b.inbox.messages.push(a)})},b.list=function(){b.inboxes=f.query()},b.findOne=function(c){b.inboxes=f.query(),b.inbox=f.get({inboxId:c},function(c){var d=b.unreadMessages(c);d>0&&(m(c),a.$broadcast("inbox_read",d))},function(){j.add("danger",k("Er is iets misgelopen met het laden van deze inbox. Probeer later opniew."),5e3)})},b.sendMessage=function(){b.newMessage&&""!==b.newMessage&&(b.busy=!0,d.post("/api/inbox/"+b.inbox._id+"/sendmessage",{message:b.newMessage}).success(function(a){b.busy=!1,b.newMessage="",b.inbox.messages.push(a)}).error(function(a){j.add("danger",k("Er is iets misgelopen met het verzenden van je berucht. Probeer later opniew."),5e3),b.busy=!1}))},b.isMessageOwner=function(a){var b=l();return a.sender===b._id},b.showInbox=function(a){b.findOne(a),c.path("/dashboard/messages/"+a)},b.getUserPicture=function(a){var b=a.sender&&a.sender._id===l()._id?a.roomOwner:a.sender,c="";return c=b&&"google"===b.provider?b.providerData.image&&b.providerData.image.url?b.providerData.image.url:b.providerData.picture||"/modules/core/img/default-user-icon.png":b&&"facebook"===b.provider?"https://graph.facebook.com/"+b.providerData.id+"/picture?type=normal":"/modules/core/img/default-user-icon.png",{"background-image":"url("+c+")"}},b.getLastMessage=function(a){return a.messages[a.messages.length-1]},b.unreadMessages=function(a){for(var b=0,c=0;c<a.messages.length;c++){var d=a.messages[c];d.sender===l()._id||d.isRead||b++}return b},b.deleteInbox=function(a,c,d){i.confirm("inbox").then(function(){a.$remove(function(){b.inboxes.splice(c,1)},function(){j.add("danger",k("Er is iets misgelopen met het verwijderen van deze inbox. Probeer later opniew."),5e3)})}),d.preventDefault()}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","$stateParams","Users","Authentication","gettext","Modal",function(a,b,c,d,e,f,g,h){function i(){a.$broadcast("blink_text")}a.user=f.user,a.busy=!1,a.nav="info",a.user||c.path("/signin"),a.hasConnectedAdditionalSocialAccounts=function(b){for(var c in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(c){a.success=a.error=null,b.delete("/api/users/accounts",{params:{provider:c}}).success(function(b){a.success=!0,a.user=f.user=b,i()}).error(function(b){a.error=b.message})},a.updateUserProfile=function(){a.success=a.error=null,new e(a.user).$update(function(b){a.success=!0,f.user=b,i()},function(b){a.error=b.data.message})},a.changeUserPassword=function(){a.success=a.error=null,b.post("/api/users/password",a.passwordDetails).success(function(b){a.success=!0,a.passwordDetails=null,i()}).error(function(b){a.error=b.message})},a.getSubscription=function(){var a=f.user.subscription.plan;return"FREE"===a?g("Student"):"PRO"===a?g("Huisbaas"):"BUSINESS"===a?g("Agentschap"):void 0},a.removeAccount=function(){h.confirm("account").then(function(){new e(a.user).$remove(function(){c.path("/")})})}}]),angular.module("users").directive("parallax",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e=Number(d.offset)||0;c.css("background-position","left "+e+"px"),a.$(a).scroll(function(){var b=a.$(a).scrollTop();console.log(b),console.log(e),c.css("background-position","left "+(b+e)+"px")})}}}]),angular.module("users").directive("scrollBottom",["$timeout",function(a){return{require:"ngModel",scope:{model:"=ngModel"},restrict:"A",link:function(b,c,d){function e(){f.scrollTop=f.scrollHeight}var f=c[0];b.$parent.$on("messages_rendered",function(){a(function(){e()},100)}),b.$watch("model",function(a,b){a&&e()})}}}]),angular.module("core").directive("userPicture",[function(){return{restriction:"A",scope:{userModel:"="},link:function(a,b,c){function d(a){return"google"===a.provider?a.providerData.image&&a.providerData.image.url?a.providerData.image.url:a.providerData.picture||"/modules/core/img/default-user-icon.png":"facebook"===a.provider?"https://graph.facebook.com/"+a.providerData.id+"/picture?type=normal":"/modules/core/img/default-user-icon.png"}a.$watch("userModel",function(a){a&&b.css({"background-image":"url("+d(a)+")"})})}}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").service("Enforcer",["Authentication","Modal",function(a,b){this.do=function(c,d){a.user?c():b.signup().then(c,d)}}]),angular.module("users").factory("Inbox",["$resource",function(a){return a("/api/inbox/:inboxId",{inboxId:"@_id"},{update:{method:"PUT"},sendMessage:{method:"POST",url:"/api/inbox/:inboxId/sendmessage"}})}]),angular.module("users").service("UserSettings",["Authentication","Users",function(a,b){function c(a){new b(e).$update(function(b){e=b,a&&a(e)})}function d(a,b,c){for(var d=b.split("."),f=d.length-1,g=d[0],h=0;h<f;h++)g=d[h],void 0===a[d[h]]&&(a[d[h]]={});1===d.length?a[g]=c:a[g][d[f]]=c,e.settings=a}var e=a.user;this.set=function(a,b,f){d(e.settings,a,b),c(f)},this.get=function(a){return e.settings[a]}}]),angular.module("users").factory("Users",["$resource",function(a){return a("/api/users",{},{update:{method:"PUT"}})}]);