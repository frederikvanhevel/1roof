"use strict";var ApplicationConfiguration=function(){var a="apollo",b=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ngAutocomplete","LocalStorageModule","angularMoment","angularFileUpload","angularMoment","gettext","btford.socket-io","angularPayments"],c=function(b){angular.module(b,[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash=""),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("en",{"Contacteer ons!":"Contact us!","Hulp nodig?":"Need Help?","Vind je ideale woonst.":"Find your ideal place to live.","© 2014 APOLLO. Alle rechten voorbehouden.":"© 2014 APOLLO. All rights reserved."})}]),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("rooms"),ApplicationConfiguration.registerModule("search"),ApplicationConfiguration.registerModule("users"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"/modules/core/views/home.client.view.html"}).state("pricing",{url:"/pricing?coupon",params:{message:{value:null},coupon:{value:null}},templateUrl:"/modules/core/views/pricing.client.view.html"}).state("about",{url:"/about",templateUrl:"/modules/core/views/about.client.view.html"}).state("promote",{url:"/promote",templateUrl:"/modules/core/views/promote.client.view.html"})}]),angular.module("core").controller("FooterController",["$scope","$rootScope",function(a,b){a.hidden=!1,b.$on("hide_footer",function(){a.hidden=!0})}]),angular.module("core").controller("HeaderController",["$rootScope","$scope","$stateParams","$location","$modal","$http","$interval","Authentication","Menus","Geocoder","Modal","gettextCatalog","Socket","amMoment","$state","Analytics",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,b,c){d.path("/search/"+a).search("lat",b).search("lng",c)}function r(a,b){console.log("changing language to %s",a),l.setCurrentLanguage(a),n.changeLanguage(a),b&&o.reload()}b.authentication=h,b.isCollapsed=!0,b.search="",b.searchDetails={},b.unreadMessageCount=0,b.init=function(){a.language=window.navigator.userLanguage||window.navigator.language,-1!==a.language.indexOf("nl")&&r("nl",!1),a.$watch("language",function(a,b){a!==b&&r(a,!0)}),a.$on("$locationChangeSuccess",function(){b.isCollapsed=!0}),h.user&&(m.emit("join",h.user._id),m.on("newMessageCount",function(a){c.inboxId&&c.inboxId===a.inbox||(b.unreadMessageCount=+b.unreadMessageCount+a.count)}),a.$on("inbox_read",function(a,c){c>0&&(b.unreadMessageCount-=c)})),p.initialize()},b.toggleCollapsibleMenu=function(){b.isCollapsed=!b.isCollapsed},b.goToSearch=function(){b.searchDetails.geometry?q(b.search.replace(/, /g,"--"),b.searchDetails.geometry.location.lat(),b.searchDetails.geometry.location.lng()):j.geocodeAddress(b.search).then(function(a){q(a.formattedAddress.replace(/, /g,"--"),a.lat,a.lng)}),b.searchDetails={}},b.openSignupModal=function(){k.signup()},b.openSigninModal=function(){k.signin()},b.getUnreadMessageCount=function(){h.user&&f({method:"GET",url:"/api/users/unreadmessages"}).then(function(a){b.unreadMessageCount=a.data})}}]),angular.module("core").controller("HomeController",["$scope","$location","Authentication","Geocoder","Alert","Meta",function(a,b,c,d,e,f){function g(a,c,d){b.path("search/"+a).search("lat",c).search("lng",d)}a.authentication=c,a.search="",a.searchDetails={},f.setTitle("Apollo",!0),a.goToSearch=function(){a.searchDetails.geometry?g(a.search.replace(/, /g,"--"),a.searchDetails.geometry.location.lat(),a.searchDetails.geometry.location.lng()):d.geocodeAddress(a.search).then(function(a){g(a.formattedAddress.replace(/, /g,"--"),a.lat,a.lng)}),a.searchDetails={}}}]),angular.module("rooms").controller("ModalPaymentController",["$rootScope","$scope","$http","$modalInstance","options","Alert",function(a,b,c,d,e,f){function g(a,e,f){c.post("/api/subscription/choose",{plan:a,card:e,couponCode:f}).success(function(a){d.close(a),b.busy=!1}).error(function(){b.busy=!1,d.dismiss({error:!0})})}b.subscriptionPlan=e.plan,b.busy=!1,b.submitPayment=function(a,c){b.busy=!0,c.error?(b.busy=!1,f.add("danger","Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw.",5e3)):g(e.plan,c.id,e.couponCode)}}]),angular.module("core").controller("PricingController",["$scope","$location","$stateParams","Authentication","Alert","Meta","$http","Modal","Enforcer",function(a,b,c,d,e,f,g,h,i){function j(b,c){g.post("/api/subscription/choose",{plan:b,couponCode:c}).success(function(b){d.user=b,e.add("success","Je tariefplan is geupdatet!",5e3),a.busy=!1}).error(function(){e.add("danger","Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw.",5e3),a.busy=!1})}a.authentication=d,a.busy=!1;var k=null;f.setTitle("Upgraden"),a.init=function(){a.message=c.message,k=c.coupon},a.choosePlan=function(b){a.busy=!0,i.do(function(){d.user&&!d.user.customerToken?h.payment({plan:b,couponCode:k}).then(function(b){d.user=b,e.add("success","Je tariefplan is geupdatet!",5e3),a.busy=!1},function(b){b.error&&e.add("danger","Er is iets misgelopen met het updaten van je tariefplan, probeer later opnieuw.",5e3),a.busy=!1}):j(b,k)})},a.isCurrentPlan=function(a){return d.user?d.user.subscriptionPlan===a:!1}}]),angular.module("core").directive("animateElement",["$window","Device",function(a,b){return{restriction:"A",link:function(c,d){if(!b.isMobile()){var e,f="fadeInUp";d.css({opacity:"0"}),d.waypoint(function(){e+=100,a.$(this).delay(e).queue(function(b){a.$(this).toggleClass("animated"),a.$(this).toggleClass(f),e=0,b()})},{offset:"90%",triggerOnce:!0})}}}}]),angular.module("core").directive("backImg",[function(){return{restriction:"A",scope:{imgProvider:"@",imgLink:"@"},link:function(a,b){var c="";a.imgProvider&&a.imgLink&&(c="cloudinary"===a.imgProvider?"http://res.cloudinary.com/dv8yfamzc/image/upload/"+a.imgLink+".png":a.imgLink,b.css({"background-image":"url("+c+")"}))}}}]),angular.module("core").directive("datePicker",["$window",function(a){return{restrict:"A",scope:{startDate:"@",dateModel:"=",minDate:"="},link:function(b,c,d){function e(a){b.dateModel=new Date(a),b.$apply()}b.appendToELement=void 0!==d.appendElement;var f,g={firstDay:1,format:"DD/MM/YYYY",onSelect:e};b.appendToELement?(f=new a.Pikaday(g),c.html(f.el)):(g.field=c[0],f=new a.Pikaday(g)),b.$watch("startDate",function(a,b){a!==b&&f.setDate(new Date(a),!0)}),b.$watch("minDate",function(){var a=new Date(b.minDate);f.setMinDate(a),a>b.dateModel&&f.setDate(a,!0)})}}}]),angular.module("core").directive("onRepeatDone",[function(){return{restriction:"A",link:function(a,b,c){a.$last&&a.$emit(c.onRepeatDone||"repeat_done",b)}}}]),angular.module("core").directive("shareButton",[function(){return{restriction:"A",link:function(a,b,c){var d=c.shareButton;"facebook"===d?b.click(function(a){window.open("//www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),a.preventDefault()}):"twitter"===d?b.click(function(a){window.open("//twitter.com/share?url="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=448"),a.preventDefault()}):"pinterest"===d?b.click(function(a){window.open("//pinterest.com/pin/create/button/?url=S"+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=436"),a.preventDefault()}):"google"===d&&b.click(function(a){window.open("//plus.google.com/share?url="+encodeURIComponent(location.href),"facebook-share-dialog","width=626,height=359"),a.preventDefault()})}}}]),angular.module("core").directive("statisticsChart",["$window",function(a){return{restriction:"E",require:"ngModel",scope:{model:"=ngModel"},link:function(b,c,d){function e(a){return a?a:0}function f(a,b){var c=i.time.day.range(a,b),d=[];return c.forEach(function(a){var b={date:a};b[j]=0,d.push(b)}),d}function g(a,b,c){for(var d=0;d<b.length;d++){for(var f=0,g=0;g<a.length;g++)if(a[g].date=new Date(a[g].date),a[g].date.getTime()===b[d].date.getTime()){f=e(a[g][j]);break}0!==d&&c?d>0&&c&&(b[d][j]=b[d-1][j]+f):b[d][j]=f}}function h(a){var b={top:20,right:30,bottom:30,left:30},d=c.parent().outerWidth()-b.left-b.right-55,e=200-b.top-b.bottom,f=i.time.scale().range([0,d]),g=i.scale.linear().range([e,0]),h=i.svg.axis().scale(f).orient("bottom"),k=i.svg.axis().scale(g).orient("left").tickSize(-d).ticks(5).tickFormat(i.format("d")),l=function(a){return new Date(a.date)},m=function(a){return+a[j]},n=i.svg.line().x(function(a){return f(l(a))}).y(function(a){return g(m(a))}).interpolate("monotone"),o=i.select(c[0]).append("svg").attr("width",d+b.left+b.right).attr("height",e+b.top+b.bottom).append("g").attr("transform","translate("+b.left+","+b.top+")");f.domain(i.extent(a,l)),g.domain(i.extent(a,m)),o.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(h),o.append("g").attr("class","y axis").call(k),o.append("path").datum(a).attr("class","line").attr("d",n),o.append("g").selectAll("circle").data(a).enter().append("circle").attr("class","data-point").attr("cx",function(a){return f(l(a))}).attr("cy",function(a){return g(m(a))}).attr("r",3.5)}var i=a.d3,j=d.value,k=new Date;k=k.setDate(k.getDate()-30);var l=f(k,new Date),m="true"===d.aggregate;b.$watch("model",function(a){a.length>0&&(g(a,l,m),h(l))})}}}]),angular.module("core").directive("videoShuffle",["$window","Device",function(a,b){return{template:'<video class="background-video" id="backgroundVideo" autoplay preload type="" style="opacity:0;" src=""></video><video class="background-video" id="stagingVideo" autoplay preload type="" style="opacity:0;" src=""></video>',restrict:"A",link:function(c,d){function e(){var a=k.videoContainer[0].videoHeight,b=k.videoContainer[0].videoWidth,c=d.width(),e=c/(b/a);k.videoContainer.css({width:c,height:e}),k.stagingContainer.css({width:c,height:e}),k.videoContainer.animate({opacity:1},2e3)}function f(){k.videoContainer[0].canPlayType("video/webm")?(k.supportedType=".webm",k.videoContainer.attr("type","video/webm;codecs='vp8'")):(k.supportedType=".mp4",k.videoContainer.attr("type","video/mp4;codecs='avc1.42E01E, mp4a.40.2'")),j=a._.shuffle(j),k.videoContainer.attr("src","/modules/core/img/video/"+j[0][0]+k.supportedType),k.videoContainer[0].load(),k.stagingContainer.attr("src","/modules/core/img/video/"+j[1][0]+k.supportedType),k.stagingContainer[0].load(),k.stagingContainer[0].pause(),i=window.setTimeout(function(){g()},j[0][1])}function g(){i=null;var a=j[1][0],b=j[1][1];j[l+1]?(a=j[l+1][0],b=j[l][1]):(l=1,a=j[1][0],b=j[j.length-1][1]),"0"===k.videoContainer.css("opacity")?(k.videoContainer[0].play(),k.videoContainer.animate({opacity:1},150,function(){k.stagingContainer.animate({opacity:0},0),k.stagingContainer.attr("src","/modules/core/img/video/"+a+k.supportedType),k.stagingContainer[0].load(),k.stagingContainer[0].pause()})):(k.stagingContainer[0].play(),k.stagingContainer.animate({opacity:1},150,function(){k.videoContainer.animate({opacity:0},0),k.videoContainer.attr("src","/modules/core/img/video/"+a+k.supportedType),k.videoContainer[0].load(),k.videoContainer[0].pause()})),l++,i=window.setTimeout(function(){g()},b)}var h="/modules/core/img/video/fallback_poster.jpg";if(b.isMobile())return void d.css({"background-image":"url("+h+")"});var i=null,j=[["bike",9900],["bikefar",4900],["house1",2900],["jonnyskateboard",5900],["kidshouse",1900],["leahdog",4900],["majesticdog",4900],["trackingdriveway",4900],["trackingstreet",3900]],k={videoContainer:d.find("#backgroundVideo"),stagingContainer:d.find("#stagingVideo")},l=2;f(),e(),c.$on("$destroy",function(){clearTimeout(i),k.stagingContainer[0].pause(),k.videoContainer[0].pause()})}}}]),angular.module("core").service("Alert",["$rootScope","$timeout",function(a,b){a.alerts=[];var c=this;this.add=function(d,e,f){a.alerts.push({type:d,msg:e,close:function(){c.closeAlert(this)}}),f&&b(function(){c.closeAlert(this)},f)},this.closeAlert=function(b){return this.closeAlertIdx(a.alerts.indexOf(b))},this.closeAlertIdx=function(b){return a.alerts.splice(b,1)}}]),angular.module("core").service("Analytics",["$window","$rootScope","$location",function(a,b,c){var d=a.ga;this.initialize=function(){d("create","UA-54653288-1",{cookieDomain:"none"}),d("send","pageview"),b.$on("$stateChangeSuccess",function(a,b){d("send","pageview",{page:c.path(),title:b.name})})},this.trackEvent=function(a,b,c,e){c||e?c&&!e?d("send","event",a,b,c):c&&e&&d("send","event",a,b,c,e):d("send","event",a,b)},this.trackException=function(a,b){d("send","exception",{exDescription:"DatabaseError",exFatal:void 0===b?!1:b})}}]),angular.module("core").service("Device",["$window",function(a,b){this.isMobile=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||b.opera),a}}]),angular.module("core").service("ExceptionHandler",["$exceptionHandler","Analytics",function(a,b){return function(a,c){console.error(a.stack),b.trackException(c)}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user"],this.menus={};var a=function(a){if(!a)return this.isPublic;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c,d){return this.menus[b]={isPublic:c||!1,roles:d||this.defaultRoles,items:[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c,d,e,f,g){return this.validateMenuExistance(b),this.menus[b].items.push({title:c,link:d,uiRoute:e||"/"+d,isPublic:f||this.menus[b].isPublic,roles:g||this.defaultRoles,shouldRender:a}),this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].link===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.addMenu("topbar")}]),angular.module("core").service("Meta",["$rootScope","$window",function(a){this.setTitle=function(b,c){var d=c?b:"Apollo - "+b;a.title=d},this.setDescription=function(b){a.description=b}}]),angular.module("core").service("Modal",["$modal","$location",function(a){this.signup=function(){var a={templateUrl:"/modules/users/views/modals/signup-modal.client.view.html",controller:"AuthenticationController",windowClass:"small"};return this.showModal(a,{})},this.signin=function(){var a={templateUrl:"/modules/users/views/modals/signin-modal.client.view.html",controller:"AuthenticationController",windowClass:"small"};return this.showModal(a,{})},this.contact=function(a){var b={templateUrl:"/modules/rooms/views/modals/contact-modal.client.view.html",resolve:{contactInfo:function(){return a}}};return this.showModal(b,{})},this.reservation=function(a){var b={templateUrl:"/modules/rooms/views/modals/reservation-modal.client.view.html",controller:"ModalController",resolve:{modalContent:function(){return a}}};return this.showModal(b,{})},this.changeAddress=function(a){var b={templateUrl:"/modules/rooms/views/modals/change-address-modal.client.view.html",controller:"ManageRoomController",resolve:{addressDetails:function(){return a}}};return this.showModal(b,{})},this.confirm=function(a){var b={templateUrl:"/modules/rooms/views/modals/confirm-modal.client.view.html",windowClass:"small",controller:"ModalController",resolve:{modalContent:function(){return a}}};return this.showModal(b,{})},this.payment=function(a){var b={templateUrl:"/modules/core/views/modals/payment-modal.client.view.html",controller:"ModalPaymentController",resolve:{options:function(){return a}}};return this.showModal(b,{})};var b={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"/modules/core/views/modal.client.view.html"},c={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(a,b){return a||(a={}),this.show(a,b)},this.show=function(d,e){var f={},g={};return angular.extend(f,b,d),angular.extend(g,c,e),f.controller||(f.controller=function(a,b){a.modalOptions=g,a.modalOptions.ok=function(a){b.close(a)},a.modalOptions.close=function(){b.dismiss("cancel")}}),a.open(f).result}}]),angular.module("core").factory("Socket",["$window","socketFactory",function(a,b){return b()}]),angular.module("core").service("Statistics",["$http","localStorageService",function(a,b){function c(b,c){a.post("/api/statistics/"+b+"/aggregate",{type:c})}var d=!1;this.aggregate=function(a,e){if(d){var f=b.get("viewedRooms")||[];-1===f.indexOf(a)&&(c(a,e),f.push(a)),b.set("viewedRooms",f)}else c(a,e)}}]),angular.module("rooms").config(["$stateProvider",function(a){a.state("createRoom",{url:"/rooms/new",templateUrl:"/modules/rooms/views/create-room.client.view.html"}).state("viewRoom",{url:"/l/:roomId/:city/:title",templateUrl:"/modules/rooms/views/view-room.client.view.html"}).state("editRoom",{url:"/rooms/:roomId/edit/:nav",templateUrl:"/modules/rooms/views/edit-room.client.view.html"}).state("analytics",{url:"/rooms/:roomId/analytics",templateUrl:"/modules/rooms/views/analytics.client.view.html"}).state("notFound",{url:"/rooms/notfound",templateUrl:"/modules/rooms/views/not-found.client.view.html"})}]),angular.module("rooms").controller("AnalyticsController",["$rootScope","$scope","$location","$http","$stateParams","Authentication","Rooms","Meta",function(a,b,c,d,e,f,g,h){function i(){d.get("/api/statistics/"+b.room._id+"/lastmonth").success(function(a){b.statisticsData=a})}b.authentication=f,b.statisticsData=[],h.setTitle("Analytics"),f.user||c.path("/"),b.init=function(){b.findOne()},b.findOne=function(){b.room=g.get({roomId:e.roomId},i)}}]),angular.module("rooms").controller("CreateRoomController",["$scope","$location","$state","Authentication","Rooms","Modal","Geocoder","Meta","$http",function(a,b,c,d,e,f,g,h,i){function j(b){g.geocodeAddress(b).then(function(b){b.accuracy<7||(a.addressDetails={street:b.street+" "+b.streetNumber,city:b.city,country:b.country,geo:[b.lng,b.lat]},a.create())})}function k(){i.get("/api/roomcount").success(function(){a.allowed=!0}).error(function(){c.transitionTo("pricing",{message:"upgrade"})})}a.authentication=d,a.createForm={address:"",roomType:""},a.autocompleteOptions={country:"be",watchEnter:!0},a.addressDetails=null,a.creationStep=1,a.busy=!1,a.allowed=!1,a.init=function(){h.setTitle("Advertentie toevoegen"),d.user?(a.creationStep=2,k()):a.allowed=!0},a.create=function(){if(a.createForm.roomType){if(null===a.addressDetails)return void j(a.createForm.address);var c=new e({location:{street:a.addressDetails.street,city:a.addressDetails.city,country:a.addressDetails.country},loc:{type:"Point",coordinates:a.addressDetails.geo},classification:a.createForm.roomType});c.$save(function(a){b.path("/rooms/"+a._id+"/edit/")},function(b){a.error=b.data.message}),a.createForm.address=""}},a.openSingupModal=function(){f.signup().then(function(){a.creationStep=2})},a.openSinginModal=function(){f.signin().then(function(){a.creationStep=2})}}]),angular.module("rooms").controller("ManageRoomController",["$scope","$stateParams","$location","Authentication","Rooms","Geocoder","$timeout","$window","Amenity","$upload","$http","Modal","Alert","Meta",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){a.busy=!0,j.upload({url:"/api/rooms/"+a.room._id+"/upload",data:{index:a.room.pictures.length},file:b}).success(function(b){a.room.pictures.push({provider:"cloudinary",link:b.id}),a.busy=!1}).error(function(){a.busy=!1,m.add("danger","Er was een probleem bij het toevoegen van de afbeelding, probeer later eens opnieuw.",5e3)})}function p(b,c){a.busy=!0,c.forEach(function(b){k.post("/api/rooms/"+a.room._id+"/upload",{link:b.link,index:a.room.pictures.length}).success(function(b){a.room.pictures.push({provider:"cloudinary",link:b.id}),a.busy=!1}).error(function(){a.busy=!1,m.add("danger","Er was een probleem bij het toevoegen van de afbeelding, probeer later eens opnieuw.",5e3)})})}function q(){a.$broadcast("blink_text")}a.authentication=d,a.createForm={address:"",roomType:""},a.autocompleteOptions={country:"be",watchEnter:!0},a.addressDetails=null,a.busy=!1,a.nav="general",a.amenities=i.list(),a.errors=[],a.newAddress="",a.newAddressDetails={},d.user||c.path("/"),a.init=function(){n.setTitle("Advertentie aanpassen"),b.nav&&(a.nav=b.nav),b.roomId||c.path("/"),a.room=e.get({roomId:b.roomId},a.watchForUpdates),a.$on("dropbox_chosen",p)},a.watchForUpdates=function(){function b(){return{visible:a.room.visible,pictures:a.room.pictures,leaseType:a.room.leaseType,available:a.room.available,loc:a.room.loc,location:a.room.location,info:a.room.info,amenities:a.room.amenities,price:a.room.price,surface:a.room.surface,cohabit:a.room.cohabit}}a.$broadcast("room_loaded",a.room),a.checkRoomCompleteness();var c=h._.debounce(a.update,800);a.$watch(b,function(b,d){b===d||a.busy||(a.checkRoomCompleteness(),c())},!0)},a.update=function(){a.room.$update(function(){q()},function(b){a.error=b.data.message})},a.onImageSelect=function(a){a.length>0&&o(a[0])},a.removeImage=function(b){a.busy=!0,k.post("/api/rooms/"+a.room._id+"/removepicture",{index:b}).success(function(){a.room.pictures.splice(b,1),a.busy=!1}).error(function(){a.busy=!1})},a.toggleAmenitySelection=function(b){var c=a.room.amenities.indexOf(b);c>-1?a.room.amenities.splice(c,1):a.room.amenities.push(b)},a.isAmenityChecked=function(b){return a.room.amenities?-1!==a.room.amenities.indexOf(b):!1},a.setTab=function(b){a.nav=b,c.path("/rooms/"+a.room._id+"/edit/"+b)},a.checkRoomCompleteness=function(){var b=[];a.room.info.title&&""!==a.room.info.title||b.push("general"),a.room.price.base&&0!==a.room.price.base||b.push("costs"),!a.room.available.immediately&&(!a.room.available.from||!a.room.available.till||new Date(a.room.available.till))<new Date&&b.push("availability"),console.log(b),a.errors=b},a.tabHasError=function(b){return-1!==a.errors.indexOf(b)},a.openAddressModal=function(){var b={newAddress:a.newAddress,newAddressDetails:a.newAddressDetails};l.changeAddress(b).then(function(b){a.room.location={street:b.street+" "+b.streetNumber,city:b.city,country:b.country},a.room.loc={type:"Point",coordinates:b.geo},a.$broadcast("room_loaded",a.room)})},a.visibilityText=function(a){return a?"online":"offline"},a.deleteRoom=function(){l.confirm("room").then(function(){a.room.$remove(function(){c.path("/dashboard/rooms")})})}}]),angular.module("rooms").controller("ModalController",["$rootScope","$scope","$modalInstance","modalContent",function(a,b,c,d){b.modalContent=d}]),angular.module("rooms").controller("RoomsController",["$rootScope","$scope","$stateParams","$http","Authentication","Rooms","Amenity","Modal","Alert","localStorageService","Statistics","Meta","$location","Enforcer",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){d.post("/api/rooms/"+b.room._id+"/favorite").success(function(){var a=e.user.favorites.indexOf(b.room._id);-1===a?(k.aggregate(b.room._id,"favorites"),e.user.favorites.push(b.room._id),i.add("success","Toegevoegd aan favorieten!",3e5)):e.user.favorites.splice(a,1)}).error(function(){i.add("danger","Er was een probleem bij het toevoegen aan je favorieten, probeer later eens opnieuw.",5e3)})}function p(a){k.aggregate(b.room._id,"messages"),d.post("/api/rooms/"+b.room._id+"/message",{message:a}).success(function(){i.add("success","Je bericht is verzonden!",5e3)}).error(function(){i.add("danger","Er was een probleem met het verzenden van je bericht, probeer later eens opnieuw.",5e3)})}function q(a){k.aggregate(b.room._id,"reservations"),d.post("/api/rooms/"+b.room._id+"/message",{message:b.appointmentDate.getTime(),messageType:"reservation"}).success(function(){a?p(a):i.add("success","Je aanvraag is verzonden!",5e3)}).error(function(){i.add("danger","Er was een probleem met het verzenden van je bericht, probeer later eens opnieuw.",5e3)})}function r(){l.setTitle(b.room.info.title+" - "+b.room.location.city,!0),l.setDescription(b.room.info.description),k.aggregate(b.room._id,"views"),b.otherRooms=f.getRoomsOfSameLocation({roomId:b.room._id}),b.$broadcast("room_loaded",b.room),0===b.room.pictures.length&&b.$emit("pictures_rendered")}function s(){m.path("/rooms/notfound")}b.authentication=e,b.contactInfo={appointmentDate:new Date,name:"",email:""},b.currentDate=new Date,b.appointmentDate=new Date,b.otherRooms=[],b.amenities=g.list(),b.isOverlay=!1,b.init=function(){b.findOne()},b.findOne=function(){b.room=f.get({roomId:c.roomId},r,s)},b.isAmenityChecked=function(a,c){return b.room.amenities?-1!==a.amenities.indexOf(c.value):!1},b.openReservationModal=function(){n.do(function(){h.reservation(b.appointmentDate).then(q)})},b.openContactModal=function(){n.do(function(){h.contact(b.contactInfo).then(p)})},b.toggleFavorite=function(){n.do(function(){o()})},b.isInfavorites=function(){return e.user?-1!==e.user.favorites.indexOf(b.room._id):!1},b.closeOverlay=function(){a.$broadcast("close_overlay")},b.isOverlay=function(){return c.isOverlay},b.visibilityText=function(a){return a?"online":"offline"},b.setVisibility=function(){d.put("/api/rooms/"+b.room._id,{visible:b.room.visible})},b.getNumber=function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}}]),angular.module("rooms").directive("addressLookup",["$window","Geocoder",function(a,b){return{restrict:"A",scope:{resultObject:"="},require:"^form",link:function(c,d,e,f){function g(a){b.geocodeAddress(a).then(function(a){d.val(a.formattedAddress),c.resultObject={street:a.street,streetNumber:a.streetNumber,city:a.city,country:a.country,geo:[a.lng,a.lat]},i()})}function h(a){for(var b="",d="",e="",f="",g=0;g<a.address_components.length;g++){var h=a.address_components[g].types[0];switch(h){case"street_number":b=a.address_components[g].long_name;break;case"route":d=a.address_components[g].long_name;break;case"locality":e=a.address_components[g].long_name;break;case"country":f=a.address_components[g].long_name}}c.resultObject={street:d,streetNumber:b,city:e,country:f,geo:[a.geometry.location.lng(),a.geometry.location.lat()]},i()}function i(){c.resultObject.street&&""!==c.resultObject.street?f.$setValidity("noStreet",!0):f.$setValidity("noStreet",!1),c.resultObject.streetNumber&&""!==c.resultObject.streetNumber?f.$setValidity("noStreetNumber",!0):f.$setValidity("noStreetNumber",!1)}f.$setValidity("",!1);var j=new a.google.maps.places.Autocomplete(d[0],{types:["geocode"]});a.google.maps.event.addListener(j,"place_changed",function(){var a=j.getPlace();a.address_components?h(a):g(a.name)})}}}]),angular.module("core").directive("blinkText",[function(){return{restrict:"A",link:function(a,b){a.$on("blink_text",function(){b.finish().show().fadeOut(1400)})}}}]),angular.module("rooms").directive("owlCarousel",["$window",function(a){return{restrict:"A",link:function(b,c,d){var e,f={autoPlay:5e3,slideSpeed:200,paginationSpeed:600,rewindSpeed:800,stopOnHover:!0,navigation:!0,pagination:"true"===d.owlPagination,rewindNav:!0,singleItem:!0,autoHeight:!1,lazyLoad:!1,mouseDrag:!1,navigationText:['<i class="icon-left-open-mini"></i>','<i class="icon-right-open-mini"></i>']},g=a.$(c);b.$on("pictures_rendered",function(){e=g.owlCarousel(f).data("owlCarousel")}),b.$on("$destroy",function(){e&&e.destroy()})}}}]),angular.module("rooms").directive("checkAddress",[function(){return{restrict:"A",link:function(a){a.createRoomForm.$setValidity("input",!1),a.$watch("autoCompleteDetails",function(b){if(b){a.createRoomForm.$setValidity("input",!0);for(var c="",d="",e="",f="",g=0;g<b.address_components.length;g++){var h=b.address_components[g].types[0];switch(h){case"street_number":c=b.address_components[g].long_name;break;case"route":d=b.address_components[g].long_name;break;case"locality":e=b.address_components[g].long_name;break;case"country":f=b.address_components[g].long_name}}""===d?a.createRoomForm.$setValidity("noStreet",!1):a.createRoomForm.$setValidity("noStreet",!0),""===c?a.createRoomForm.$setValidity("noStreetNumber",!1):a.createRoomForm.$setValidity("noStreetNumber",!0),a.createRoomForm.$valid&&(a.addressDetails={street:d+" "+c,city:e,country:f,geo:[b.geometry.location.lng(),b.geometry.location.lat()]})}})}}}]),angular.module("core").directive("dropboxChooser",["$window",function(a){return{restrict:"A",scope:{chooserSuccess:"&"},link:function(b,c){var d={success:function(a){b.$emit("dropbox_chosen",a)},linkType:"direct",multiselect:!1,extensions:["images"]};c.click(function(){a.Dropbox.choose(d)})}}}]),angular.module("core").directive("limitText",[function(){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel"},link:function(a,b,c){a.$watch("model",function(b,d){b!==d&&a.model&&(a.model=a.model.substring(0,c.limitText))})}}}]),angular.module("rooms").directive("roomMap",["$window",function(a){return{template:'<div id="map" class="map-canvas"></div>',restrict:"A",link:function(b,c){function d(a){return"room"===a?"lodging":"appartment"===a?"commercial":"building"}var e=null,f=a.L.mapbox.map(c[0],"defreek.j27p0821",{zoomControl:!1});b.$on("room_loaded",function(b,c){f.setView([c.loc.coordinates[1],c.loc.coordinates[0]],15),f.dragging.disable(),f.touchZoom.disable(),f.doubleClickZoom.disable(),f.scrollWheelZoom.disable(),f.tap&&f.tap.disable(),e&&e.clearLayers(),e=a.L.mapbox.featureLayer({type:"Feature",geometry:c.loc,properties:{"marker-size":"medium","marker-color":"#f44","marker-symbol":d(c.classification)}}).addTo(f)}),b.$on("$destroy",function(){f.remove()})}}}]),angular.module("rooms").directive("streetView",["$window",function(a){return{scope:{center:"=mapCenter"},template:"<div></div>",restrict:"A",link:function(b,c){b.$on("room_loaded",function(b,d){function e(a,b,c){a.setPosition(b),a.setPov({heading:c,zoom:1,pitch:0}),a.setVisible(!0)
}var f=d.loc.coordinates,g=new a.google.maps.LatLng(f[1],f[0]),h=new a.google.maps.StreetViewPanorama(c[0],{zoomControl:!1,position:g,pov:{heading:0,pitch:0,zoom:1}}),i=new a.google.maps.StreetViewService,j=50;i.getPanoramaByLocation(g,j,function(b,c){if(c===a.google.maps.StreetViewStatus.OK){var d=g;g=b.location.latLng;var f=a.google.maps.geometry.spherical.computeHeading(g,d);e(h,g,f)}})})}}}]),angular.module("rooms").factory("Amenity",[function(){return{list:function(){return[{name:"TV",value:"television"},{name:"Internet",value:"internet"},{name:"Terras",value:"terrace"},{name:"Auto garage",value:"parking"},{name:"Fietsstalling",value:"bicycleParking"},{name:"Dubbel glas",value:"doubleGlass"},{name:"Bemeubeld",value:"furnished"},{name:"Aparte badkamer",value:"seperateBathroom"},{name:"Aparte keuken",value:"seperateKitchen"},{name:"Huisdieren toegelaten",value:"pets"},{name:"Domicilie verplicht",value:"domicile"}]}}}]),angular.module("rooms").factory("Rooms",["$resource",function(a){return a("/api/rooms/:roomId",{roomId:"@_id"},{update:{method:"PUT"},getMyRooms:{method:"GET",url:"/api/myrooms",isArray:!0},getRoomsOfSameLocation:{method:"GET",url:"/api/rooms/:roomId/same",isArray:!0}})}]),angular.module("search").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("search",{url:"/search/:address",templateUrl:"/modules/search/views/search.client.view.html"}).state("search.overlay",{url:"/rooms/:roomId/:isOverlay",templateUrl:"/modules/rooms/views/view-room.client.view.html"}),b.deferIntercept()}]).run(["$rootScope","$urlRouter","$location","$state","Device",function(a,b,c,d,e){a.$on("$locationChangeSuccess",function(a,c,d){a.preventDefault(),e.isMobile()||-1===d.indexOf("/search/")||-1===c.indexOf("/l/")?b.sync():console.log("skipping route"),b.listen()})}]),angular.module("search").controller("SearchController",["$rootScope","$scope","$timeout","$location","$state","$stateParams","Geocoder","Rooms","$window","Amenity","Authentication","Users","localStorageService","Meta","Enforcer","UserSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){a.lat&&a.lng&&(b.filter.location=[parseFloat(a.lng),parseFloat(a.lat)]),a.proximity&&(b.filter.proximity=a.proximity),a.minPrice&&(b.filter.minPrice=+a.price),a.maxPrice&&(b.filter.maxPrice=+a.maxPrice),a.roomType&&(b.filter.roomType=a.roomType),a.size&&(b.filter.size=+a.size),a.amneties&&(b.filter.amneties=a.amneties)}function r(a){g.geocodeAddress(a).then(function(a){b.mapCenter=[a.lng,a.lat],b.filter.proximity=a.proximity})}function s(){h.query(b.filter,function(a){var c=b.results,d=a,e=c.map(function(a){return a._id}),f=d.map(function(a){return a._id}),g=i._.difference(e,f),h=i._.difference(f,e);c=c.filter(function(a){return!i._.contains(g,a._id)}),d.forEach(function(a){i._.contains(h,a._id)&&c.push(a)}),b.results=c})}function t(){e.transitionTo("search",f,{reload:!1,location:!1}),w&&(d.url(w),w=null),n.setTitle("Zoeken in "+f.address),b.selectedRoomId=null,b.isOverLayOpen=!1}function u(){e.transitionTo("search.overlay",f,{reload:!1,location:!1}),b.$broadcast("close_marker_popups"),b.isOverLayOpen=!0}b.user=k.user,b.mapCenter=[4.35171,50.85034],b.mapZoom=13,b.fetchOnMapChange=!0,b.filter={location:[],proximity:3600,roomType:[],minPrice:0,maxPrice:2e3,size:null,amenities:[]},b.results=[],b.amenities=j.list(),b.selectedRoomId=null,b.isOverLayOpen=!1;var v=m.get("viewedRooms")||[],w=null;b.init=function(){function c(a){var b=Math.floor(Math.log(20088e3/a)/Math.log(2));return b>19&&(b=19),0>b&&(b=0),b}n.setTitle("Zoeken in "+f.address);var e=d.search();a.$watch(function(){return d.path()},function(a,c){-1!==a.indexOf("/search")&&-1!==c.indexOf("/l/")&&(b.selectedRoomId=null)}),e.lat&&e.lng||!f.address?e.lat&&e.lng?(q(e),b.mapCenter=b.filter.location,b.mapZoom=c(b.filter.proximity)):b.mapZoom=9:r(f.address),f.roomId&&(b.selectedRoomId=f.roomId,u()),b.user&&b.user.settings.email.newRooms&&b.updateSettings(),s(),a.$on("close_overlay",t),b.$watch("filter",function(a,b){a!==b&&x()},!0)},b.mapChangedEvent=function(a){b.filter.proximity=a.proximity/2,b.filter.location=[a.lng,a.lat],d.search("lat",a.lat).search("lng",a.lng).search("proximity",b.filter.proximity),c(function(){b.$apply()})},b.toggleAmenitySelection=function(a){var c=b.filter.amenities.indexOf(a);c>-1?b.filter.amenities.splice(c,1):b.filter.amenities.push(a)},b.selectRoom=function(a,c){if(b.selectedRoomId&&b.selectedRoomId===a)b.selectedRoomId=null,t();else{b.selectedRoomId=a,i._.extend(f,{roomId:a,isOverlay:!0});var e=d.url();-1!==e.indexOf("/search")&&(w=d.url(),d.url(c)),u(),-1===v.indexOf(a)&&v.push(a)}},b.hasSeenRoom=function(a){return-1!==v.indexOf(a)},b.openRoomPopup=function(a){b.$broadcast("open_marker_popup",a)},b.getRoomTypeIcon=function(a){return"room"===a?"lodging":"appartment"===a?"commercial":"building"},b.setRoomType=function(a){return"all"===a?[]:[a]},b.isNewRoom=function(a){return new Date-new Date(a.updated)<864e5},b.updateSettings=function(){o.do(function(){p.set("alert.filters",{location:b.filter.location,proximity:b.filter.proximity})})};var x=i._.debounce(s,400)}]),angular.module("search").directive("checkboxGroup",["$window",function(a){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel"},link:function(b,c){var d=c.children("button");d.bind("click",function(c){var d=a.$(c.currentTarget),e=d.attr("data-val"),f=b.model.indexOf(e);d.hasClass("active")?(-1!==f&&b.model.splice(f,1),d.removeClass("active")):(-1===f&&b.model.push(e),d.addClass("active")),c.stopPropagation()})}}}]),angular.module("search").directive("googleMap",["$window",function(a){return{scope:{markers:"=mapMarkers",center:"=mapCenter",zoom:"=mapZoom",options:"=mapOptions",changedEvent:"=mapChanged"},template:'<div id="map" class="map-canvas"></div>',restrict:"A",link:function(b,c){function d(){var b=h.getBounds(),c=b.getSouthWest(),d=b.getNorthEast();return a.google.maps.geometry.spherical.computeDistanceBetween(c,d)}function e(){f.forEach(function(a){a.setMap(null)}),f=[]}var f=[],g={center:new a.google.maps.LatLng(b.center[1],b.center[0]),zoom:b.zoom,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:a.google.maps.ZoomControlStyle.SMALL},mapTypeId:a.google.maps.MapTypeId.ROADMAP},h=new a.google.maps.Map(c[0],g);b.changedEvent&&(h.addListener("dragend",function(){b.changedEvent({lng:h.getCenter().lng(),lat:h.getCenter().lat(),proximity:d()})}),h.addListener("zoom_changed",function(){b.changedEvent({lng:h.getCenter().lng(),lat:h.getCenter().lat(),proximity:d()})})),b.$watchCollection("markers",function(b,c){b!==c&&(e(),b.forEach(function(b){var c=new a.google.maps.Marker({map:h,position:new a.google.maps.LatLng(b.loc.coordinates[1],b.loc.coordinates[0]),icon:new a.google.maps.MarkerImage("/modules/rooms/img/map-marker2.svg")});f.push(c)}))}),b.$watch("center",function(b,c){b!==c&&h.setCenter(new a.google.maps.LatLng(b[1],b[0]))}),b.$watch("zoom",function(a,b){a!==b&&h.setZoom(a)})}}}]),angular.module("search").directive("mapboxMap",["$compile","$q","$window","$http","$timeout",function(a,b,c,d,e){var f;return{restrict:"E",transclude:!0,replace:!0,scope:{center:"=mapCenter",zoom:"=mapZoom",changedEvent:"=mapChanged",preventPopups:"=",selectRoom:"="},template:'<div class="map-canvas" ng-transclude></div>',link:function(b,g,h){function i(a){b.markers.forEach(function(b){b.roomId===a&&b.openPopup()})}function j(){var a=b.map.getBounds(),c=a.getNorthWest(),d=a.getSouthEast();return Math.floor(c.distanceTo(d))}function k(){var a=b.map.getCenter(),e={client_id:"4I5SHYQHG4OXY2ZCCRTFPNYFVK0U0G4NPLIBKLWGM2SWLPVY",client_secret:"11YEGLXWQBXX4KERSY2CXLMC4E3C2X021DGZLXVVMK0KRWJZ",ll:a.lat+","+a.lng,radius:j(),v:"20140701",categoryId:"4bf58dd8d48988d1ae941735"};d({url:"https://api.foursquare.com/v2/venues/search",method:"GET",params:e}).success(function(a){a.response.venues.forEach(function(a){{var b=c.L.latLng(a.location.lat,a.location.lng);c.L.marker(b,{icon:c.L.divIcon({className:"maki-icon college"})}).bindPopup('<a target="_blank" href="https://foursquare.com/v/'+a.id+'">'+a.name+"</a>").addTo(m)}})})}b.map=c.L.mapbox.map(g[0],"defreek.j27p0821").setView([b.center[1],b.center[0]],b.zoom),f.resolve(b.map),b.isClusteringMarkers=void 0!==h.clusterMarkers;var l=void 0!==h.scaleToFit;b.fitMapToMarkers=function(){if(l){var a=new c.L.featureGroup(b.markers);b.map.fitBounds(a.getBounds())}};var m=(new c.L.featureGroup).addTo(b.map);b.changedEvent&&b.map.on("moveend",function(){var a=b.map.getCenter();b.changedEvent({lng:a.lng,lat:a.lat,proximity:j()})}),b.$on("open_marker_popup",function(a,c){b.preventPopups||i(c)}),b.$on("close_marker_popups",function(){b.markers.forEach(function(a){a.closePopup()})}),b.map.on("popupopen",function(){var c=angular.element(document.getElementsByClassName("leaflet-popup-content"));a(c)(b),e(function(){b.$apply()})}),b.$on("$destroy",function(){b.map.remove()}),k()},controller:["$scope",function(a){a.markers=[],a.featureLayers=[],f=b.defer(),a.getMap=this.getMap=function(){return f.promise},c.L.MarkerClusterGroup&&(a.clusterGroup=new c.L.MarkerClusterGroup({showCoverageOnHover:!1}),this.getMap().then(function(b){b.addLayer(a.clusterGroup)})),this.$scope=a}]}}]),angular.module("search").directive("mapboxMarker",["$compile","$window",function(a,b){var c={navy:"#001f3f",blue:"#0074d9",aqua:"#7fdbff",teal:"#39cccc",olive:"#3d9970",green:"#2ecc40",lime:"#01ff70",yellow:"#ffdc00",orange:"#ff851b",red:"#ff4136",fuchsia:"#f012be",purple:"#b10dc9",maroon:"#85144b",white:"white",silver:"#dddddd",gray:"#aaaaaa",black:"#111111"};return{restrict:"E",require:"^mapboxMap",transclude:!0,scope:!0,replace:!0,link:function(d,e,f,g,h){function i(a,b){var d=b||{};return a.size&&(d["marker-size"]=a.size),a.color&&(d["marker-color"]="#"===a.color[0]?a.color:c[a.color]||a.color),a.icon&&(d["marker-symbol"]=a.icon),d}var j,k={draggable:void 0!==f.draggable},l=i(f),m=function(a,c,d,e,f){e=e||{};var h=b.L.mapbox.marker.style({properties:f},[c.lat,c.lng]);return d&&d.length>0&&(h.bindPopup(d,{closeButton:!1,minWidth:320}),h.roomId=c.roomId),g.$scope.isClusteringMarkers&&e.excludeFromClustering!==!0?g.$scope.clusterGroup.addLayer(h):h.addTo(a),e.draggable&&h.dragging.enable(),g.$scope.markers.push(h),h},n=function(a,b,c,d){d=i(d,{"marker-color":"#000","marker-symbol":"star"}),c.excludeFromClustering=!0,a.on("locationfound",function(b){j=m(a,[b.latlng.lat,b.latlng.lng],null,c,d)}),a.locate()};g.getMap().then(function(b){setTimeout(function(){for(var c="",i=h(d,function(){}),o=0;o<i.length;o++)void 0!==i[o].outerHTML&&(c+=i[o].outerHTML);if(void 0!==f.currentLocation)n(b,null,k,l);else{if(c){var p=angular.element(c);a(p)(d),d.$$phase||d.$digest();var q="";for(o=0;o<p.length;o++)q+=p[o].outerHTML;j=m(b,f,q,k,l)}else j=m(b,f,null,k,l);e.bind("$destroy",function(){g.$scope.isClusteringMarkers?g.$scope.clusterGroup.removeLayer(j):b.removeLayer(j)})}},0)})}}}]),angular.module("search").directive("radioGroup",["$window","$timeout",function(a,b){return{require:"ngModel",restrict:"A",scope:{model:"=ngModel",outputFunction:"="},link:function(c,d){function e(a){c.model=c.outputFunction?c.outputFunction(a):a,b(function(){c.$apply()})}var f=d.children("button"),g=d.children("button.active");e(g.attr("data-val")),f.bind("click",function(b){var c=a.$(b.currentTarget);c.hasClass("active")||(f.removeClass("active"),c.addClass("active")),e(c.attr("data-val")),b.stopPropagation()})}}}]),angular.module("search").directive("rangeSlider",["$window",function(a){return{restrict:"A",scope:{start:"@",step:"@",end:"@",callback:"@",margin:"@",ngModel:"=",ngFrom:"=",ngTo:"="},link:function(b,c){var d,e,f,g,h;return g=a.$(c),d=b.callback?b.callback:"slide",null!==b.ngFrom&&null!==b.ngTo?(e=null,h=null,g.noUiSlider({start:[b.ngFrom||b.start,b.ngTo||b.end],step:parseFloat(b.step||1),connect:!0,margin:parseFloat(b.margin||0),range:{min:[parseFloat(b.start)],max:[parseFloat(b.end)]}}),g.on(d,function(){var a=g.val(),c=a[0],d=a[1];return e=parseFloat(c),h=parseFloat(d),b.$apply(function(){return b.ngFrom=e,b.ngTo=h,h})}),b.$watch("ngFrom",function(a){return a!==e?g.val([a,null]):void 0}),b.$watch("ngTo",function(a){return a!==h?g.val([null,a]):void 0})):(f=null,g.noUiSlider({start:[b.ngModel||b.start],step:parseFloat(b.step||1),range:{min:[parseFloat(b.start)],max:[parseFloat(b.end)]}}),g.on(d,function(){return f=parseFloat(g.val()),b.$apply(function(){return b.ngModel=f,f})}),b.$watch("ngModel",function(a){return a!==f?g.val(a):void 0}))}}}]),angular.module("core").factory("Geocoder",["localStorageService","$q","$timeout","$rootScope",function(a,b,c,d){var e=a.get("locations")?a.get("locations"):{},f=[],g=250,h=function(){var b=f[0],i=new google.maps.Geocoder;i.geocode({address:b.address},function(i,j){if(j===google.maps.GeocoderStatus.OK){for(var k={lat:i[0].geometry.location.lat(),lng:i[0].geometry.location.lng(),formattedAddress:i[0].formatted_address,accuracy:i[0].address_components.length},l=0;l<i[0].address_components.length;l++){var m=i[0].address_components[l].types[0];switch(m){case"street_number":k.streetNumber=i[0].address_components[l].long_name;break;case"route":k.street=i[0].address_components[l].long_name;break;case"locality":k.city=i[0].address_components[l].long_name;break;case"country":k.country=i[0].address_components[l].long_name}}e[b.address]=k,a.set("locations",e),f.shift(),b.d.resolve(k)}else j===google.maps.GeocoderStatus.ZERO_RESULTS?(f.shift(),b.d.reject({type:"zero",message:"Zero results for geocoding address "+b.address})):j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?b.executedAfterPause&&(f.shift(),b.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+b.address})):j===google.maps.GeocoderStatus.REQUEST_DENIED?(f.shift(),b.d.reject({type:"denied",message:"Request denied for geocoding address "+b.address})):(f.shift(),b.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+j+", address="+b.address}));if(f.length)if(j===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var n=f[0];n.executedAfterPause=!0,c(h,g)}else c(h,0);d.$$phase||d.$apply()})};return{geocodeAddress:function(a){var c=b.defer();return _.has(e,a)?c.resolve(e[a]):(f.push({address:a,d:c}),1===f.length&&h()),c.promise}}}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").config(["$stateProvider",function(a){a.state("profile",{url:"/settings/profile",templateUrl:"/modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"/modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"/modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"/modules/users/views/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"/modules/users/views/signin.client.view.html"}).state("forgot",{url:"/forgot",templateUrl:"/modules/users/views/forgot.client.view.html"}).state("reset",{url:"/reset/:token",templateUrl:"/modules/users/views/reset.client.view.html"}).state("dashboard",{url:"/dashboard/:nav",templateUrl:"/modules/users/views/dashboard.client.view.html"}).state("viewInbox",{url:"/dashboard/messages/:inboxId",templateUrl:"/modules/users/views/inbox.client.view.html",reloadOnSearch:!1}).state("favorites",{url:"/users/:userId/favorites",templateUrl:"/modules/users/views/favorites.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$stateParams","$http","$location","$q","Authentication","Modal",function(a,b,c,d,e,f,g){a.authentication=f,a.busy=!1,a.authentication.user&&d.path("/"),a.signup=function(){var b=e.defer();a.busy=!0,c.post("/auth/signup",a.credentials).success(function(c){return a.authentication.user=c,a.$close&&a.$close(),b.resolve(),a.busy=!1,b.promise}).error(function(c){return a.error=c.message,b.reject(),a.busy=!1,b.promise})},a.signin=function(){var b=e.defer();a.busy=!0,c.post("/auth/signin",a.credentials).success(function(c){return a.authentication.user=c,a.$close&&a.$close(),b.resolve(),a.busy=!1,b.promise}).error(function(c){return a.error=c.message,b.reject(),a.busy=!1,b.promise})},a.forgot=function(){a.success=a.error=null,a.busy=!0,c.post("/auth/forgot",a.credentials).success(function(b){a.credentials=null,a.success=b.message,a.busy=!1}).error(function(b){a.credentials=null,a.error=b.message,a.busy=!1})},a.reset=function(){a.success=a.error=null,a.busy=!0,c.post("/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.success=b.message,a.passwordDetails=null,a.busy=!1}).error(function(b){a.error=b.message,a.busy=!1})},a.openSignupModal=function(){a.$dismiss&&a.$dismiss(),g.signup()},a.openSigninModal=function(){a.$dismiss&&a.$dismiss(),g.signin()}}]),angular.module("users").controller("DashboardController",["$scope","$stateParams","$state","$location","Rooms","Authentication","Meta",function(a,b,c,d,e,f,g){a.authentication=f,a.nav="rooms",f.user||d.path("/"),a.init=function(){g.setTitle("Dashboard"),b.nav&&(a.nav=b.nav)},a.getMyRooms=function(){a.myrooms=e.getMyRooms()},a.setTab=function(b){a.nav=b,d.path("/dashboard/"+b)},a.goToRoom=function(a){d.path("/rooms/"+a)},a.visibilityText=function(a){return a?"online":"offline"},a.updateRoom=function(a){a.$update()},a.viewAnalytics=function(a){"BUSINESS"!==f.user.subscriptionPlan?c.transitionTo("pricing",{message:"analytics"}):d.path("/rooms/"+a._id+"/analytics")}}]),angular.module("users").controller("FavoritesController",["$scope","$http","$location","$stateParams","Authentication","Meta",function(a,b,c,d,e,f){function g(){b.get("/api/users/"+a.user._id+"/favorites").success(function(b){a.favorites=b,a.busy=!1}).error(function(){a.busy=!1})}a.authentication=e,a.favorites=[],a.busy=!1,a.init=function(){b.get("/api/users/"+d.userId).success(function(b){a.user=b,f.setTitle("Wishlist van "+a.user.displayName),g()})}}]),angular.module("users").controller("InboxController",["$rootScope","$scope","$location","$http","$stateParams","Inbox","Authentication","Socket","Modal",function(a,b,c,d,e,f,g,h,i){function j(a){a.messages.forEach(function(a){a.sender!==g.user._id&&(a.isRead=!0)}),a.$update()}b.authentication=g,b.newMessage="",b.busy=!1,g.user||c.path("/"),b.init=function(){b.findOne(e.inboxId),b.inbox.$promise.then(function(a){h.emit("join",a._id)}),b.$on("$destroy",function(){h.emit("leave",b.inbox._id)}),h.on("newMessage",function(a){b.inbox.messages.push(a)})},b.list=function(){b.inboxes=f.query()},b.findOne=function(c){b.inboxes=f.query(),b.inbox=f.get({inboxId:c},function(c){var d=b.unreadMessages(c);d>0&&(j(c),a.$broadcast("inbox_read",d))})},b.sendMessage=function(){b.newMessage&&""!==b.newMessage&&(b.busy=!0,d.post("/api/inbox/"+b.inbox._id+"/sendmessage",{message:b.newMessage}).success(function(){b.busy=!1,b.newMessage=""}).error(function(){b.busy=!1}))},b.isMessageOwner=function(a){return a.sender===g.user._id},b.showInbox=function(a){b.findOne(a),c.path("/dashboard/messages/"+a)},b.getUserPicture=function(a){var b=a.sender._id===g.user._id?a.roomOwner:a.sender,c="";return"local"===b.provider?c="/modules/core/img/default-user-icon.png":"google"===b.provider?c=b.providerData.picture:"facebook"===b.provider&&(c="http://graph.facebook.com/"+b.providerData.id+"/picture?type=normal"),{"background-image":"url("+c+")"}},b.getLastMessage=function(a){return a.messages[a.messages.length-1]},b.unreadMessages=function(a){for(var b=0,c=0;c<a.messages.length;c++){var d=a.messages[c];d.sender===g.user._id||d.isRead||b++}return b},b.deleteInbox=function(a,c,d){i.confirm("inbox").then(function(){a.$remove(function(){b.inboxes.splice(c,1)})}),d.preventDefault()}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","$stateParams","Users","Authentication",function(a,b,c,d,e,f){a.user=f.user,a.busy=!1,a.nav="info",a.user||c.path("/"),a.hasConnectedAdditionalSocialAccounts=function(){for(var b in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(c){a.success=a.error=null,b.delete("/api/users/accounts",{params:{provider:c}}).success(function(b){a.success=!0,a.user=f.user=b}).error(function(b){a.error=b.message})},a.updateUserProfile=function(){a.success=a.error=null;var b=new e(a.user);b.$update(function(b){a.success=!0,f.user=b},function(b){a.error=b.data.message})},a.changeUserPassword=function(){a.success=a.error=null,b.post("/api/users/password",a.passwordDetails).success(function(){a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message})},a.getSubscription=function(){var a=f.user.subscriptionPlan;return"FREE"===a?"Student":"PRO"===a?"Huisbaas":"BUSINESS"===a?"Agentschap":void 0}}]),angular.module("users").directive("scrollBottom",["$timeout",function(a){return{require:"ngModel",scope:{model:"=ngModel"},restrict:"A",link:function(b,c){function d(){e.scrollTop=e.scrollHeight}var e=c[0];b.$parent.$on("messages_rendered",function(){a(function(){d()},100)}),b.$watch("model",function(a){a&&d()})}}}]),angular.module("core").directive("userPicture",[function(){return{restriction:"A",scope:{userModel:"="},link:function(a,b){function c(a){return"google"===a.provider?a.providerData.picture:"facebook"===a.provider?"http://graph.facebook.com/"+a.providerData.id+"/picture?type=normal":"/modules/core/img/default-user-icon.png"}a.$watch("userModel",function(a){a&&b.css({"background-image":"url("+c(a)+")"})})}}}]),angular.module("users").factory("Authentication",[function(){var a=this;return a._data={user:window.user},a._data}]),angular.module("users").service("Enforcer",["Authentication","Modal",function(a,b){this.do=function(c,d){a.user?c():b.signup().then(c,d)}}]),angular.module("users").factory("Inbox",["$resource",function(a){return a("/api/inbox/:inboxId",{inboxId:"@_id"},{update:{method:"PUT"},sendMessage:{method:"POST",url:"/api/inbox/:inboxId/sendmessage"}})}]),angular.module("users").service("UserSettings",["Authentication","Users",function(a,b){function c(a){var c=new b(e);c.$update(function(b){e=b,a&&a(e)})}function d(a,b,c){for(var d=b.split("."),f=d.length-1,g=d[0],h=0;f>h;h++)g=d[h],void 0===a[d[h]]&&(a[d[h]]={});a[g][d[f]]=c,e.settings=a}var e=a.user;this.set=function(a,b,f){d(e.settings,a,b),c(f)},this.get=function(a){return e.settings[a]}}]),angular.module("users").factory("Users",["$resource",function(a){return a("/api/users",{},{update:{method:"PUT"}})}]);