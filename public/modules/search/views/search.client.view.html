<section data-ng-controller="SearchController" class="search-view" ng-init="init()">

  <div class="sidebar">


    <div class="filters bordered">
      <h6 class="title">Narrow down your search</h6>

      <div class="filter type-filter">
        <div class="btn-group" ng-model="filter.roomType" output-function="setRoomType" radio-group>
          <button type="button" class="btn minimal" data-val="house"><div class="maki-icon building"></div> House</button>
          <button type="button" class="btn minimal" data-val="appartment"><div class="maki-icon commercial"></div> App.</button>
          <button type="button" class="btn minimal" data-val="room"><div class="maki-icon lodging"></div> Room</button>          
          <button type="button" class="btn minimal active" data-val="all">All</button>
        </div>
      </div>

      <div class="filter">
        <div class="slider-label"><h6>€ {{filter.minPrice}} - € {{filter.maxPrice}} <small>per month</small></h6></div>
        <div class="slider" range-slidera ng-from="filter.minPrice" ng-to="filter.maxPrice" start="0" end="1200" step="50"></div>
      </div>
    </div>

    
    <div class="sidebar-header">
      <small class="text-center" ng-if="results.length > 0">{{results.length}} rooms found</small>
      <small class="text-center" ng-if="results.length == 0">
        No results were found with this criteria. Try using less filters or zoom out the map!
      </small>
    </div>

    <div class="search-results">

      <ul class="results-list">        
        <li class="search-result" ng-repeat="room in results" ng-click="selectRoom(room._id)" ng-mouseenter="openRoomPopup(room._id)" ng-class="{ 'active': room._id == selectedRoomId, 'is-seen': hasSeenRoom(room._id) }">
            <div class="result-type">
              <div class="maki-icon" ng-class="getRoomTypeIcon(room.classification)"></div>
            </div>
            <div class="result-info">
              <span class="result-price pull-right">€ {{room.price.total}}</span>
              <a href="#" class="result-location">{{room.location.street}}</a>
              <br>
              <small>2 bathrooms</small>
            </div>
            <div class="clearfix"></div>
        </li>
      </ul>

    </div>

  </div>

  <div class="map">

    <mapbox-map class="map-canvas" map-center="mapCenter" map-zoom="mapZoom" map-changed="mapChangedEvent" prevent-popups="isOverLayOpen" cluster-markers="false" select-room="selectRoom">
        <mapbox-marker lat="{{room.loc.coordinates[1]}}" lng="{{room.loc.coordinates[0]}}" color="#FA6C65" icon="{{getRoomTypeIcon(room.classification)}}"  ng-repeat="room in results" room-id="{{room._id}}">

            <div class="row marker" style="background-image: url(//res.cloudinary.com/dv8yfamzc/image/upload/{{room.pictures[0]}}.png);" ng-click="selectRoom('{{room._id}}')">

              <div data-val="{{room.pictures.length == 0}}" class="no-image tint-bg">
                <i class="icon-camera-1"></i>
              </div>

              <div class="col-xs-12">

                <div class="pull-right">
                  <button class="btn btn-default btn-xs">More info <i class="icon-right-open-1"></i></button>
                </div>
                <h1>{{room.location.street}}</h1>
                <span class="bottom-right">&euro; {{room.price.total}}</span>

              </div>

            </div>

        </mapbox-marker>
    </mapbox-map>    

  </div>
  
  <div class="room-overlay" ui-view ng-if="selectedRoomId != null"></div>

</section>